webpackJsonp([0],{0:function(a,b,c){"use strict";c.p=Ark.CDN_PUBLIC_PATH+"js/dist/reader/",c(1),c(13),c(17).initialize(),document.addEventListener("contextmenu",function(a){return a.preventDefault()}),document.addEventListener("keydown",function(a){!a.ctrlKey&&!a.metaKey||"p"!==a.key&&80!==a.keyCode||a.preventDefault()})},1:function(a,b,c){var d,e;d=[c(2),c(3),c(6),c(9)],void 0!==(e=function(a,b,c,d){return a.inhert=a.View.extend,a.ajax=function(a){b.extend(a,{processData:!0});var e=d.call(this,a),f=new c.Deferred,g=f.promise();return e.done(function(a,c,d){if(!a)return f.resolve(arguments);var e=!!a.r||!!a.error;return b.isUndefined(a.r)||delete a.r,e?f.reject(d,"error",a.msg||a.error||"出现了奇怪的错误, 请稍后再试"):f.resolve(a)}).fail(function(a,b,c){f.reject.apply(this,arguments)}),g},a}.apply(b,d))&&(a.exports=e)},9:function(a,b,c){var d,e;d=[c(6),c(10)],void 0!==(e=function(a,b){function d(){var d=arguments,e=d[d.length-1]||{};if(e.arkWithDocReferer&&b("prev_referer",document.referrer,{path:"/","max-age":2}),e.type&&"GET"!==e.type.toUpperCase()&&(e.headers=a.extend({},e.headers,{"X-CSRF-Token":b("ck")})),b("profile")){var f=null;a.each(e,function(a,b){"dataFilter"===a&&(f=b,delete d[a])}),e=a.extend(e,{dataFilter:function(b,d){try{b=a.parseJSON(b)}catch(a){b=b}return c.e(1,function(a){var c=[a(11)];(function(a){a=a||Ark.profile,a.add({time:b.pt,uri:b.uri,type:e.type,stdout:b.profile})}).apply(null,c)}),null===f?b.rawData:f(b.rawData)}})}return a.ajax.apply(a,d)}function e(){}return d.post=function(b,c,e,f){return a.isFunction(c)&&(f=f||e,e=c,c=void 0),d({type:"POST",url:b,data:c,success:e,dataType:f||"json"})},d.get=function(a,b,c){return d({type:"GET",url:a,success:b,dataType:c||"json"})},d.methodMap={read:"GET",create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE"},d.request=function(b,c,e,f,g){return a.isFunction(e)&&(g=f,f=e,e={}),d(a.extend({type:b,url:c,data:e,dataType:g||"text"},f))},e.prototype=new Error,e.prototype.name="HasBannedWordsError",e.prototype.message="含不当词语，请修改",d.HasBannedWordsError=e,d.censor=function(b){return d.post("/j/has_banned_words",b).then(function(b){if(b)return a.Deferred().reject(new e)})},d.censorThenPost=function(a,b){var c=arguments;return d.censor(b).then(function(){return d.post.apply(d,c)})},d.censorThenRequest=function(a,b,c){var e=arguments;return d.censor(c).then(function(){return d.request.apply(d,e)})},d.censorThen=function(a){var b=arguments;return d.censor(a.data).then(function(){return d.apply(null,b)})},d}.apply(b,d))&&(a.exports=e)},10:function(a,b,c){var d;"function"==typeof Symbol&&Symbol.iterator,function(e,f){void 0!==(d=function(){return f()}.call(b,c,b,a))&&(a.exports=d)}(0,function(){function a(a){var b=document.cookie.match(new RegExp("(?:\\s|^)"+a+"\\=([^;]*)"));return b?decodeURIComponent(b[1]):null}function b(a,b,c){c=c||{};var d,e,f,g=a+"="+encodeURIComponent(b),h=c.path?"; path="+c.path:"",i=c.domain?"; domain="+c.domain:"",j=c["max-age"],k=c.secure?"; secure":"";c.expires?f=c.expires:j&&(d=new Date,d.setTime(d.getTime()+1e3*j),f=d.toGMTString()),f&&(e="; expires="+f),document.cookie=[g,e,h,i,k].join("")}function c(a){b(a,"",{"max-age":0})}var d=function(c,d,e){return 1===arguments.length?a(c):b(c,d,e)};return d.get=a,d.set=b,d.remove=c,d})},12:function(a,b,c){"use strict";a.exports=c(3).template},13:function(a,b,c){(function(b){"use strict";a.exports=b.$=c(14)}).call(b,function(){return this}())},14:function(a,b,c){(function(b){a.exports=b.jQuery=c(15)}).call(b,function(){return this}())},15:function(a,b,c){var d,e;d=[c(6)],void 0!==(e=function(a){function b(){return!1}var d=a.cleanData;a.cleanData=function(b){for(var c,e=0;null!=(c=b[e]);e++)try{a(c).triggerHandler("removing")}catch(a){}d(b)};var e=window,f=document,g=e.PointerEvent||e.MSPointerEvent,h=e.DocumentTouch&&f instanceof DocumentTouch,i="ontouchstart"in e||h,j=i||g,k=/mobile|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),l=!j||!k;return i?(c.e(2,function(a){var b=[a(16)];(function(a){a(document,{tapAlways:!1,preventMouse:!0})}).apply(null,b)}),l?a:(a.fn.extend({on:function(c,d,e,f,g){var h,i;if("object"==typeof c){"string"!=typeof d&&(e=e||d,d=void 0);for(i in c)this.on(i,d,e,c[i],g);return this}if(null==e&&null==f?(f=d,e=d=void 0):null==f&&("string"==typeof d?(f=e,e=void 0):(f=e,e=d,d=void 0)),!1===f)f=b;else if(!f)return this;return 1===g&&(h=f,f=function(b){return a().off(b),h.apply(this,arguments)},f.guid=h.guid||(h.guid=a.guid++)),this.each(function(){c=/click/g.test(c)&&!/preventDefault/g.test(f)&&d?c.replace("click","tap"):c,a.event.add(this,c,f,e,d)})}}),a)):a}.apply(b,d))&&(a.exports=e)},17:function(a,b,c){var d,e;d=[c(6),c(2),c(3),c(20),c(21),c(23),c(18),c(24),c(199),c(59),c(325)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j,k){function l(){b.sync=g.sync,b.fakeSync=g.fakeSync,i.checkStorageVersion(),h.fitForDesktop()&&a("html").addClass("fit-for-desktop"),c.extend(e,{me:new k(d.me),navigate:function(){var a=e.router;a&&a.navigate.apply(a,arguments)}});var l=a("body");l.on("click",'a[href="#"]',function(a){a.preventDefault()}).on("click","[data-target-dialog=login]",function(){e.trigger("open:login-dialog")}).on("contextmenu dragstart","img, .pic",function(a){a.preventDefault()}),e.on("open:login-dialog",function(){j({closable:a(this).data("closable")})}),/msie 8/i.test(navigator.userAgent)&&l.on("selectstart",function(a){if("TEXTAREA"!==a.target.nodeName)return!1}),f.initialize()}return{initialize:l}}.apply(b,d))&&(a.exports=e)},18:function(a,b,c){var d,e;d=[c(6),c(19)],void 0!==(e=function(a,b){function c(b,c,d){var e=new a.Deferred,f=e.resolve().promise();return d.success&&f.done(d.success),d.error&&f.fail(d.error),f}function d(a){return a.fakeSync||a.collection&&a.collection.fakeSync?c:b}function e(a,b,c){return d(b).apply(this,[a,b,c])}return{sync:e,fakeSync:c}}.apply(b,d))&&(a.exports=e)},19:function(a,b,c){var d,e;d=[c(3),c(2)],void 0!==(e=function(a,b){var c=function(){throw new Error('A "url" property or function must be specified')},d={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};return function(e,f,g){var h=d[e],i={type:h,dataType:"json"};g=g||{},g.url||(i.url=a.result(f,"url")||c()),g.data||!f||"create"!==e&&"update"!==e&&"patch"!==e||(i.data=g.attrs||f.toJSON(g)),"PATCH"!==i.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(i.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var j=g.xhr=b.ajax(a.extend(i,g));return f.trigger("request",f,j,g),j}}.apply(b,d))&&(a.exports=e)},20:function(a,b,c){var d,e;d=[],void 0!==(e=function(){return window.Ark||{}}.apply(b,d))&&(a.exports=e)},21:function(a,b,c){var d,e;d=[c(22)],void 0!==(e=function(a){return a()}.apply(b,d))&&(a.exports=e)},22:function(a,b,c){var d,e;d=[c(6),c(3),c(2)],void 0!==(e=function(a,b,c){var d=function(){this._cached={}};return b.extend(d.prototype,c.Events),b.extend(d.prototype,{init:function(a){this.namespace=a,b.extend(this,this.getAttrsFromNamespace())},getAttrsFromNamespace:function(){var a=this.namespace;return this._cached[a]?this._cached[a]:(this._cached[a]={vent:b.extend({},c.Events),_models:{}},this._cached[a])},setModel:function(a,b){this._models[a]=b,"content"===a&&(console.log(b),this.DownloadContent(b)),this.vent.trigger("model:"+a+":set",b)},getModel:function(a){if(!this._models[a])throw Error("model/"+a+" does not exist.");return this._models[a]},unsetModel:function(a){delete this._models[a]},hasModel:function(a){return this._models&&!!this._models[a]},getModelPromise:function(b){var c=a.Deferred();return this.hasModel(b)?c.resolve(this.getModel(b)):this.vent.once("model:"+b+":set",function(a){c.resolve(a)}),c.promise()},DownloadContent:function(a){var b=a.body,c="",d="",e=b[0].titlePageInfo,f=e.title;c+=e.title+"\n\n",c+="作者: "+e.author+"\n\n",e.translator&&(c+="译者: "+e.translator+"\n\n");for(var g=1;g<b.length;g++){b[g].title!=d&&(d=b[g].title,c+=b[g].title+"\n");for(var h=0;h<b[g].paragraphs.length;h++){c+=b[g].paragraphs[h].text.replace(/<sup>/g,"").replace(/<\/sup>/g,"").replace(/<span class="sup-content">/g,"").replace(/<span>/g,"").replace(/<\/span>/g,"").replace(/<dfn>/g,"").replace(/<\/dfn>/g,"")+"\n"}}var j=new Blob([c],{type:"text/plain;charset="+document.characterSet}),k=window.URL.createObjectURL(j),l=document.createElement("a");l.style.display="none",document.body.appendChild(l),l.href=k,l.download=f,l.click(),window.URL.revokeObjectURL(k)}}),function(){return new d}}.apply(b,d))&&(a.exports=e)},23:function(a,b,c){var d,e;d=[c(2),c(6),c(3),c(20),c(21),c(27),c(28),c(9),c(24),c(29),c(31),c(32),c(35),c(76),c(59)],void 0!==(e=function(a,b,d,e,f,g,h,i,j,k,l,m,n,o,p){function q(a){i({type:"post",url:"/j/article_v2/read_probe",data:{aid:a}})}function r(){var a=t,b=window.location.pathname.replace(/[^\/]$/,"$&/")===a;!b&&e.works&&k.set("works",e.works),b&&!e.works&&(e.works=k.get("works")||{})}function s(){f.router=new C,j.hasPushState()||r(),a.history.start({pushState:!0,root:t})}var t="/reader/",u=e.EBOOK_STYLE_SHEET,v=e.GALLERY_STYLE_SHEET,w=e.COLUMN_STYLE_SHEET,x=function(a){return{ebookId:a[0]}},y=function(a){return{columnId:a[0],ebookId:a[1]}},z=function(a,c){return c=c||{urlArgsParser:x},function(){var g=d.toArray(arguments),h=this,i=c.urlArgsParser(g),k=i.ebookId;this._ebookId=k,q(k);var l=this.getWorksType(k),m="c"===e.works.type&&!j.fitForMobile(),n={reading:u,gallery:v};m?B.use([u,w]):B.use(n[l]),f.init(l),this.readingCleanup(),this.initConfigModel({worksType:l,isChapter:c.isChapter,isLiteStyle:m}),b("html").toggleClass("justify-failed",j.justifyFailed()).toggleClass("has-bad-chinese-line-break",j.hasBadChineseLineBreak()),this.requireReadView(l,k,function(b){a.apply(h,[b].concat(g)),h.switchPageView(b.name)})}},A=function(a){var b={urlArgsParser:y,isChapter:!0};return z(function(b,c,e){var f=d.toArray(arguments);this._columnId=c,this.setChapterConfig(b),this.chapterAdapter=new o({columnId:c,chapterId:e}).render({canvas:b}),this.chapterAdapter.modelPromise.done(d.bind(function(){this._initColumnLayout(),a.apply(this,f)},this))},b)},B=new g([u,v,w]),C=a.Router.extend({routes:{"":"home","ebook/:ebookId/":"ebook","column/:columnId/chapter/:chapterId/":"chapter","ebook/:ebookId/recommendation/:rId/":"showRecommendation","ebook/:ebookId/show-underline/*query":"showUnderline","ebook/:ebookId/annotation/:annotationId/*query":"openSingleAnnotation","ebook/:ebookId/para-annotations/:paraId/":"openParaAnnotations","ebook/:ebookId/toc/:index/":"gotoToc","column/:columnId/chapter/:chapterId/list/":"chapterWithList","column/:columnId/chapter/:chapterId/recommendation/:rId/":"showChapterRecommendation","column/:columnId/chapter/:chapterId/show-underline/*query":"showChapterUnderline","column/:columnId/chapter/:chapterId/annotation/:annotationId/*query":"openChapterSingleAnnotation","column/:columnId/chapter/:chapterId/para-annotations/:paraId/":"openChapterParaAnnotations","ebook/:ebookId/page/:pageNumber/":"redirectToEbook","*actions":"redirectToHome"},initialize:function(){this.body=b("body"),this.viewNames=["readView","galleryView"];var a=this;b("body").on("click","a[data-permalink]",function(b){if(!(b.altkey||b.ctrlKey||b.metaKey||b.shiftKey)){b.preventDefault();var c=this.getAttribute("href").replace(/^\/reader\//,"");a.navigate(c,{trigger:!0})}}).on("click","a[data-in-app-go-back]",function(b){if(b.preventDefault(),f.atLandingView){var c=this.getAttribute("href");a.navigate(c,!0)}else history.go(-1)}),this.bindLandingHandler()},bindLandingHandler:function(){function a(b){/^route:/.test(b)&&(f.atLandingView=!1,this.off("all",a))}function b(c){/^route:/.test(c)&&(this.off("all",b),this.on("all",a),f.atLandingView=!0)}this.on("all",b),this.on("all",this._trackPageview)},switchPageView:function(a){f.trigger("pageView:switched"),this.removeGalleryThemeClass(),d.each(this.viewNames,function(b){b!==a&&f[b]&&f[b].hide()}),f[a].show()},readingCleanup:function(){try{f.getModel("config").resetModel()}catch(a){f.setModel("config",new m)}f.hasModel("article")&&f.getModel("article").unbindAll(),this.cleanChapterAdapter()},initConfigModel:function(a){var b=f.getModel("config"),c="gallery"===a.worksType;b.set("isGallery",c).set("isChapter",!!a.isChapter),(a.isLiteStyle||j.fitForMobile())&&b.setIgnoreSavingKey("layout",!0),a.isLiteStyle&&b.set("layout","vertical"),j.fitForMobile()&&b.set("layout",c?"vertical":"horizontal")},removeGalleryThemeClass:function(){this.body.removeClass("day-theme night-theme")},home:function(){this.redirectToHome()},ebook:z(function(a,b,c){if(h.getURLParameter("donation_succeed",c))return history.replaceState&&history.replaceState(null,null,location.pathname),a.renderThenShowToast(b,"donation_succeed");a.render(b)}),_initColumnLayout:function(){"c"!==e.works.type||j.fitForMobile()||(this.columnLayout=this.columnLayout||new n,this.columnLayout.render({model:this.chapterAdapter.columnModel}))},chapter:A(function(a,b,c,d){if(h.getURLParameter("donation_succeed",d))return history.replaceState&&history.replaceState(null,null,location.pathname),a.renderThenShowToast(c,"donation_succeed");a.render(c)}),chapterWithList:A(function(a,b,c){a.renderThenOpenChapterList(c)}),setChapterConfig:function(a){var b=f.getModel("config");a.$el.addClass("is-chapter"),b.once("change:isChapter",function(){a.$el.removeClass("is-chapter")})},cleanChapterAdapter:function(){this.chapterAdapter&&(this.chapterAdapter.remove(),delete this.chapterAdapter,f.getModel("config").unset("isChapter"))},showUnderline:z(function(a,b,c,d){var e=this.getUnderlineData(d);a.renderThenShowUnderline(b,e)}),showRecommendation:z(function(a,b,c){a.renderThenOpenRecommendation(b,c)}),openSingleAnnotation:z(function(a,b,c){j.fitForDesktop()||this.redirectToEbook(b),a.renderThenOpenAnnotation(b,c)}),openParaAnnotations:z(function(a,b,c){j.fitForDesktop()||this.redirectToEbook(b),a.renderThenOpenParaAnnotations(b,c)}),gotoToc:z(function(a,b,c){a.renderThenGotoChapter(b,c)}),showChapterRecommendation:A(function(a,b,c,d){a.renderThenOpenRecommendation(c,d)}),showChapterUnderline:A(function(a,b,c,d,e){var f=this.getUnderlineData(e);a.renderThenShowUnderline(c,f)}),openChapterSingleAnnotation:A(function(a,b,c,d){j.fitForDesktop()||this.redirectToChapter(),a.renderThenOpenAnnotation(c,d)}),openChapterParaAnnotations:A(function(a,b,c,d){j.fitForDesktop()||this.redirectToChapter(),a.renderThenOpenParaAnnotations(c,d)}),redirectToEbook:function(a){var b=["ebook",a,""].join("/");return this.navigate(b,{trigger:!0,replace:!0})},redirectToChapter:function(){var a=this.getBookUrl();return this.navigate(a,{trigger:!0,replace:!0})},getWorksType:function(a){var b={g:"gallery",t:"reading",c:"reading"},c=b.t;if(!j.hasPushState()&&e.works.id!==a)return this.redirectTryGetWorksType(),c;f.cachedWorksTypeSymobol||(f.cachedWorksTypeSymobol={});var g=f.cachedWorksTypeSymobol[a]||e.works.type;return f.cachedWorksTypeSymobol[a]=g,e.works=d.extend(e.works||{},{type:g}),b[g||"t"]},requireReadView:function(a,b,d){function e(a){f[h]=f[h]||new a,f[h].name=h,d(f[h])}var g={gallery:"galleryView",reading:"readView"},h=g[a];switch(h){case"readView":c.e(4,function(a){var b=[a(81)];e.apply(null,b)}.bind(this));break;case"galleryView":c.e(7,function(a){var b=[a(244)];e.apply(null,b)}.bind(this));break;default:this.redirectToHome()}},_trackPageview:function(){var b=a.history.getFragment();l._trackPageview(t+b)},redirectToHome:function(){e.me.isAnonymous?p({closable:!1}):location.href="/reader/all"},redirectTryGetWorksType:function(){var b=a.history.getFragment(),c=a.history.root;window.location.replace(c+b+window.location.search)},cleanUrl:function(a){a=d.extend({trigger:!1,replace:!0},a),this.navigate(this.getBookUrl({ignoreSearch:!0}),a)},getBookUrl:function(a){a=a||{};var b=window.location.search||"",c=f.getModel("config");return b=a.ignoreSearch?"":b,(c.get("isChapter")?["column",this._columnId,"chapter",this._ebookId,""].join("/"):["ebook",this._ebookId,""].join("/"))+b},getUnderlineData:function(a){var b=h.deparam(a||""),c={};d.each(["startContainerId","endContainerId","startOffset","endOffset"],function(a){c[a]=+b[a]});var e=b.middleContainers;return c.middleContainers=e?d.map(e.split(","),function(a){return+a}):[],c},getReviewsUrl:function(){var a="/"+this.getBookUrl({ignoreSearch:!0});return a+=f.getModel("config").get("isChapter")?"comments":"reviews?sort=score"},getQuestionsUrl:function(){return"/"+this.getBookUrl({ignoreSearch:!0})+"questions"}});return{initialize:s}}.apply(b,d))&&(a.exports=e)},24:function(a,b,c){var d,e;d=[c(6),c(3),c(25),c(26)],void 0!==(e=function(a,b,c,d){var e=document.createRange();return b.extend({fitForMobile:b.memoize(function(){return d("screen and (-webkit-min-device-pixel-ratio: 1.1) and (max-width: 720px), screen and (max-device-width: 480px)").matches}),fitForDesktop:b.memoize(function(){return!/mobile|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent)}),hasBadChineseLineBreak:b.memoize(function(){var a=["<span>禁</span>","<span>则</span>","<span>，</span>","<span>换</span>","<span>行</span>","<span>问</span>","<span>题</span>"," ","<span>abcd</span>","<span>,</span>"].join(""),b=["position:absolute","font-size:12px","width:2em","visibility:hidden","left: 0"].join(";"),c=document.createElement("div");c.style.cssText=b,c.innerHTML=a,document.body.appendChild(c);var d=c.children[2],e=c.children[8],f=c.children[3],g=c.children[4],h=0===d.getBoundingClientRect().left||0===e.getBoundingClientRect().left,i=f.getBoundingClientRect().top!==g.getBoundingClientRect().top;return document.body.removeChild(c),h||i}),justifyFailed:b.memoize(function(){var a=["position:absolute","font-size:12px","width:2.3em","visibility:hidden","text-align:justify","text-justify:inter-ideograph","-ms-text-justify:inter-ideograph"].join(";"),b=document.createElement("div");b.style.cssText=a,b.innerHTML=Array(4).join("<span>测</span>"),document.body.appendChild(b);var c=b.children[0],d=b.children[1],e=c.getBoundingClientRect(),f=d.getBoundingClientRect(),g=f.left-e.right,h=e.width||e.right-e.left,i=f.width||f.right-f.left;return g=g||h-i,document.body.removeChild(b),g<1}),punctuationProhibitionInconsistent:b.memoize(function(){var a=["position:absolute","font-size:12px","width:47px","visibility:hidden"].join(";"),b=document.createElement("div"),c=void 0;b.style.cssText=a,document.body.appendChild(b),b.innerHTML="急急，11<mark>1</mark>",c=b.getElementsByTagName("mark")[0];var d=c.getBoundingClientRect().left;b.innerHTML="<span>急</span><span>急</span><span>，</span><span>11</span><mark>1</mark>",c=b.getElementsByTagName("mark")[0];var e=c.getBoundingClientRect().left,f=Math.abs(d-e);return document.body.removeChild(b),f>12}),mightParaLinesOverflow:function(a,b){var c=b.children[0].childNodes,d=c.length,f=c[d-1];if(f){var g=void 0,h=f.nodeType;if(3===h){var i=f.length;if(1===d&&i<28)return;e.setStart(f,i-1),e.setEnd(f,i),g=e.getBoundingClientRect().right}else{if(1!==h)return!1;g=f.getBoundingClientRect().right}return a-g<32}}},c)}.apply(b,d))&&(a.exports=e)},25:function(a,b,c){var d,e;d=[],void 0!==(e=function(){var a={},b=window,c=document,d=["webkit","moz"],e=navigator.userAgent,f=/\[Ark(?:[\w-]*)\/([\d.]+[\w-]*)\]/,g=/MicroMessenger/i,h=/Weibo/i,i=/com\.douban\.frodo/i;a.hasTouch=function(){return!!("ontouchstart"in b||(b.PointerEvent||b.MSPointerEvent)&&/IEMobile/.test(e)||b.DocumentTouch&&c instanceof DocumentTouch)},a.hasPushState=function(){return!(!b.history||!b.history.pushState)},a.canFullscreen=function(){for(var a=0;a<d.length;a++)if(c[d[a]+"CancelFullScreen"])return!0;return!!document.cancelFullScreen||!1},a.standalone=function(){return b.navigator.standalone},a.hasOrientationEvent=function(){return!!("DeviceOrientationEvent"in b)},a.checkWebkitScrollNative=function(){return"WebkitOverflowScrolling"in document.documentElement.style||!(e.indexOf("Android")>=0&&parseFloat(e.slice(e.indexOf("Android")+8))<3)},a.isWeixin=function(){return g.test(e)},a.isWeibo=function(){return h.test(e)},a.isFrodo=function(){return i.test(e)},a.isInApp=function(){return f.test(e)},a.isMobile=function(){return this.isAndroid||this.isiPhone},a.isRetina=function(){return b.devicePixelRatio>1||!(!b.matchMedia||!b.matchMedia("(-webkit-min-device-pixel-ratio: 1.5), \t       (min--moz-device-pixel-ratio: 1.5), \t       (-o-min-device-pixel-ratio: 3/2), \t       (min-resolution: 1.5dppx)").matches)};for(var j=["iPhone","Android","iPad"],k=0,l=j.length;k<l;k++){var m=j[k];a["is"+m]=new RegExp(m,"i").test(e)}return a.hasPinchZoom=function(){return!!a.isiPhone||(e.indexOf("Android")>=0&&parseFloat(e.slice(e.indexOf("Android")+8))>=4||void 0)},a.hasWebStorage=function(){try{var a="Storage"in window&&null!==window.Storage;return a&&(localStorage.setItem("storage",""),localStorage.removeItem("storage")),a}catch(a){return!1}},a.isApplePhone=a.isiPhone,a}.apply(b,d))&&(a.exports=e)},26:function(a,b,c){var d;void 0!==(d=function(){var a,b=document,c=b.documentElement,d=c.firstElementChild||c.firstChild,e=b.createElement("body"),f=b.createElement("div");return f.id="mq-test-1",f.style.cssText="position:absolute;top:-100em",e.style.background="none",e.appendChild(f),window.matchMedia||function(b){return f.innerHTML='&shy;<style media="'+b+'">#mq-test-1{width:42px;}</style>',c.insertBefore(e,d),a=42===f.offsetWidth,c.removeChild(e),{matches:a,media:b}}}.call(b,c,b,a))&&(a.exports=d)},27:function(a,b,c){var d,e;d=[c(3)],void 0!==(e=function(a){var b=function(a,b){this.styleSheets=this.getStyleSheets(a),b?this.use(b):this.disableAll()};return a.extend(b.prototype,{getStyleSheets:function(b){var c=document.styleSheets,d={};return a.each(c,function(c){var e=c.ownerNode||c.owningElement;if(e.id){var f=e.id;a.contains(b,f)&&(d[f]=c)}}),d},use:function(b){a.isString(b)&&(b=[b]),this.currentStyleSheet&&!a.difference(this.currentStyleSheet,b).length||(this.currentStyleSheet=b,this.disableAll(),a.each(this.styleSheets,function(c,d){a.each(b,function(a){a===d&&(c.disabled=!1)})}))},disableAll:function(){a.each(this.styleSheets,function(a,b){a.disabled=!0})}}),b}.apply(b,d))&&(a.exports=e)},28:function(a,b,c){var d;"function"==typeof Symbol&&Symbol.iterator,function(e,f){void 0!==(d=function(){return f()}.call(b,c,b,a))&&(a.exports=d)}(0,function(){function a(a){return a.replace(/[\/]+/g,"/").replace(/\/\?/g,"?").replace(/\/\#/g,"#").replace(/\:\//g,"://")}var b={};b.getURLParameter=function(a,b){b=b||location.search;var c=b.match(RegExp(a+"=(.+?)(&|$)"));return c?decodeURIComponent(c[1]):null},b.deparam=function(a){for(var b={},c=a.replace(/\+/g," ").split("&"),d=0,e=c.length;d<e;d++){var f=c[d],g=f.split("="),h=decodeURIComponent([g[0]]),i=decodeURIComponent([g[1]]);b[h]=i}return b};var c=b.join=function(){return a([].slice.call(arguments,0).join("/"))};b.addParam=function(a,b){var c="";for(var d in b)if(b.hasOwnProperty(d)){var e=b[d];""!==e&&void 0!==e&&(c&&(c+="&"),c+=encodeURIComponent(d)+"="+encodeURIComponent(e))}if(!c)return a;var f="",g="",h=a,i=h.indexOf("#"),j=h.indexOf("?");return-1!==i&&(f=h.substr(i),h=h.slice(0,i)),-1!==j&&(g=h.substr(j),h=h.slice(0,j)),h+(g?g+"&"+c:"?"+c)+(f||"")};var d=b.hasSameOrigin=function(a,b){return"/"===a[0]||new RegExp("^"+b).test(a)};return b.getRelativeUrl=function(a,b){return"/"!==a[0]&&d(a,b)?c("/",a.substr(b.length)):a},b.getBackboneFragment=function(a){return a.replace(/^\/?/,"")},b})},29:function(a,b,c){var d,e;d=[c(30)],void 0!==(e=function(a){return new a(!0,"session")}.apply(b,d))&&(a.exports=e)},30:function(a,b,c){var d;(function(e){"use strict";void 0!==(d=function(){function a(a,b){"session"!==b&&(b="local"),this._cache={},this._wantsWebStorage=void 0===a||a,this._useWebStorage=this._wantsWebStorage&&c,c&&(this._storage=window[b+"Storage"])}var b={has:function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},keys:Object.keys||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var c=[];for(var d in a){if(!b.has(a,d))return;c.push(d)}return c},isObject:function(a){return a===Object(a)}},c=function(){try{var a="Storage"in window&&null!==window.Storage;return a&&(localStorage.setItem("storage",""),localStorage.removeItem("storage")),a}catch(a){return!1}}();return e.extend(a.prototype,{setStorageObject:function(a,b){this._storage.setItem(a,JSON.stringify(b))},getStorageObject:function(a,b){var c=this._storage.getItem(a);try{c=JSON.parse(c)}catch(a){c=null}return c},getStorageKeys:function(){for(var a=[],b=0,c=this._storage.length;b<c;b++)a.push(this._storage.key(b));return a},get:function(a){return this._useWebStorage?this._storage.getItem(a+"___isObject")?this.getStorageObject(a)||void 0:this._storage.getItem(a)||void 0:this._cache[a]||void 0},set:function(a,c){if(this._useWebStorage)if(c&&b.isObject(c))this.setStorageObject(a,c),this._storage.setItem(a+"___isObject",!0);else try{this._storage.setItem(a,c)}catch(a){}else this._cache[a]=c;return c},remove:function(a){this._useWebStorage&&(this._storage.removeItem(a),this._storage.removeItem(a+"___isObject")),delete this._cache[a]},length:function(){return this._useWebStorage?this._storage.length:this._cache.length},keys:function(){return this._useWebStorage?this.getStorageKeys():b.keys(this._cache)},clear:function(){this._useWebStorage&&this._storage.clear(),this._cache={}}}),a}.call(b,c,b,a))&&(a.exports=d)}).call(b,c(6))},31:function(a,b,c){var d;void 0!==(d=function(){var a={};return a._trackPageview=function(a){a=a.replace(/page.*/,""),ga("send","pageview","/"+a)},a._trackEvent=function(a,b){void 0!==b&&null!==b||(b=document.title),"number"==typeof b&&(b=b.toString()),ga("send","event","reader",a,b)},a._trackTiming=function(a,b,c,d){"number"!=typeof b&&(c=parseInt(c,10)),void 0!==c&&null!==c||(c=document.title),"number"==typeof c&&(c=c.toString()),ga("send","timing","reader",a,b,c)},a}.call(b,c,b,a))&&(a.exports=d)},32:function(a,b,c){var d,e;d=[c(3),c(2),c(10),c(33),c(24),c(34)],void 0!==(e=function(a,b,c,d,e,f){var g={pageWidth:43.375,pageGutter:0,pageOffset:0,fontSize:16,lineHeight:2,verticalPageHeight:768};return b.Model.extend({defaults:function(){return a.defaults({layout:d.get("layout")||"horizontal",annotationsConfig:new f,hasShownAnnotationGuide:this.hasShownAnnotationGuide(),isNewUser:this.isNewUser()},g)},storageKeys:["layout"],ignoreSavingKeys:{},initialize:function(){e.fitForMobile()&&(this.ignoreSavingKeys.layout=!0,this.set("layout","horizontal")),this.bindLocalStorageData(),this.bindCookieData()},bindLocalStorageData:function(){a.each(this.storageKeys,function(a){this.on("change:"+a,function(b,c){this.ignoreSavingKeys[a]||d.set(a,c)})},this)},bindCookieData:function(){this.on("change:hasShownAnnotationGuide",function(a,b){this.ignoreSavingKeys.hasShownAnnotationGuide||b&&this.setCookieOn("hsag")},this).on("change:isNewUser",function(a,b){this.ignoreSavingKeys.isNewUser||b||this.setCookieOn("hst")},this)},getVerticalPageHeightEm:function(){return this.get("verticalPageHeight")/this.get("fontSize")},getLineHeightPx:function(){return this.get("lineHeight")*this.get("fontSize")},isNewUser:function(){return!this.hasCookieSet("hst")},hasShownAnnotationGuide:function(){return this.hasCookieSet("hsag")},hasCookieSet:function(a){return c(a)},setCookieOn:function(a){return c(a,1,{"max-age":31536e3,path:"/reader"}),this},resetModel:function(){return this.unset("ignoreSaveProgress",{silent:!0}).unset("ignoreGuide",{silent:!0}),this},setIgnoreSavingKey:function(a,b){return this.ignoreSavingKeys[a]=b,this}})}.apply(b,d))&&(a.exports=e)},33:function(a,b,c){var d,e;d=[c(30)],void 0!==(e=function(a){return new a(!0,"local")}.apply(b,d))&&(a.exports=e)},34:function(a,b,c){var d,e;d=[c(2),c(3),c(20),c(33)],void 0!==(e=function(a,b,c,d){return a.Model.extend({storageKey:"annotationsConfig",defaults:function(){return b.defaults(this.getStorageData(),{showOthers:!0,othersFilter:"all"})},initialize:function(){this.on("change",this.setStorageData)},isFilterOut:function(a){var b=this.toJSON();return!(b.showOthers?"followOnly"!==b.othersFilter||this.filterByTags(a,["mine","favorite","following"]):this.filterByTags(a,["mine","favorite"]))},filterByTags:function(a,c){return!!b.intersection(c,a.get("tags")).length},getStorageData:function(){if(c.me.isAnonymous)return{};var a=d.get(this.storageKey);return a?JSON.parse(a):{}},setStorageData:function(a){d.set(this.storageKey,JSON.stringify(a.toJSON()))}})}.apply(b,d))&&(a.exports=e)},35:function(a,b,c){var d,e;d=[c(2),c(3),c(6),c(20),c(25),c(21),c(36),c(37),c(46),c(48),c(49),c(61)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j,k,l){return a.View.extend({el:"#ark-reader",tmplHeader:c("#tmpl-column-header").html(),tmplFooter:c("#tmpl-column-footer").html(),initialize:function(){this.vent=f.vent,this.vent.on("paging:finish",this.renderFrame,this),this.$el.addClass("lite-theme")},events:{"click .btn-purchase":"buy"},getChapterTitle:function(a){return this.chaptersIdList=this.chaptersIdList||[],this.chaptersIdList.length||(this.chaptersIdList=b.map(this.chaptersList,function(a){return a.id})),this.chaptersMap[this.chaptersIdList[b.indexOf(this.chaptersIdList,this.currentChapterId)+a]]},renderFrame:function(){var a=f.getModel("article"),c=a.get("metaData").isOriginWorks;this.chapterOverlayClone=this.$el.find(".article .chapter-overlay").clone(!0),this.chaptersMap=this.chaptersMap||{},this.currentChapterId=a.id,b.each(this.chaptersList,b.bind(function(a){this.chaptersMap[a.get("id")]=a.get("title")},this)),b.extend(this.modelData,{chapter_id:this.currentChapterId}),this.$el.find(".lite-header").length||this.renderHeader(),this.chapterOverlayClone.find(".chapter-prev").text(this.getChapterTitle(-1)).end().find(".chapter-next").text(this.getChapterTitle(1)),this.$el.find(".lite-footer .chapter-overlay-container").html(this.chapterOverlayClone),delete this.chapterOverlayClone;var d=this.$el.find(".chapter-custom-container .inner").empty();c&&l.appendDonateBar(d,a),l.appendSharingButtons(d,a);var e=new k({commentsUrl:"/j/article_v2/"+this.currentChapterId+"/comment",commentTargetInfo:{article:{authorId:f.getModel("article").get("authorId")}}});d.append(e.$el)},renderHeader:function(){var a=b.pick(this.modelData,"agent","title","id","price","kind");b.extend(a,{isSample:this.modelData.is_sample,hasAdded:this.modelData.is_paid,isAnonymous:d.me.isAnonymous,canSale:this.modelData.can_sale}),this.$el.prepend(b.template(this.tmplHeader,a)).append(b.template(this.tmplFooter));var e=this.$el.find(".lite-header");if(this.renderSubscribeButton(this.$(".btn-subscribe"),this.model),this.modelData.is_sample&&this.appendPurchaseButton(this.model),!this.modelData.is_paid&&0==+this.modelData.price){var f=this.model;j.apply({aid:this.modelData.identity,title:this.modelData.title,wrapper:e,placeholderSel:".btn-adding-wrapper",success:function(){f.set("is_paid",!0)}}).render(),e.find(".lnk-collect").addClass("head-controls-item").attr("data-helper",function(){return c(this).text()})}},render:function(a){this.model=a.model,this.$el.find(".aside-controls").show(),this.modelData=this.model.toJSON(),this.chaptersList=this.chaptersList||this.modelData.chapters},buy:function(a){a.preventDefault(),d.me.isAnonymous||this.purchaseWidget.doPurchase()},appendPurchaseButton:function(a){var b=i(a,{isLightBtn:!0});b.$(".btn").addBack(".btn").addClass("btn-column btn-purchase head-controls-item").attr("data-helper",b.$(".btn").text()),this.$el.find(".btn-purchase-wrapper").html(b.el),this.purchaseWidget=new h(b.$el)},renderSubscribeButton:function(a,b){function c(b){var c=b?"取消订阅":"订阅";a.removeClass("is-loading").toggleClass("is-subscribed",b).attr("data-helper",c).attr("title",c)}if(b.get("has_finished"))return void a.hide();c(b.get("is_subscribed")),a.on("click",function(){d.me.isAnonymous?f.trigger("open:login-dialog"):(b.toggleSubscribe(),a.addClass("is-loading"))}),b.on("change:is_subscribed",function(a,b){c(b),g.toast(b?"已订阅":"已取消")})}})}.apply(b,d))&&(a.exports=e)},36:function(a,b,c){var d,e;d=[c(6),c(3)],void 0!==(e=function(a,b){var c=a(window),d=a("body"),e=function(a){this.options=b.defaults(a||{},this.defaults);var d=b.result(this,"el");d.html(a.text);var e=d.outerWidth(),f=(c.width()-e)/2;if(d.css({left:f}),"middle"===a["vertical-align"]){var g=(c.height()-d.outerHeight())/2;d.css({top:g})}b.delay(function(){d.fadeOut(function(){d.remove()})},a.delay)};b.extend(e.prototype,{defaults:{delay:1e3,id:"toast-container",text:"加载中"},el:function(){var b=this.options,c=b.id,e=a("#"+c);return e.length?e.stop(!0).css({opacity:e.data("orig-opacity")||1}):(e=a("<div>",{id:c}).appendTo(d),e.data("orig-opacity",e.css("opacity"))),e}});var f={toast:{"vertical-align":"middle",delay:900}};return b.each(["alert","toast"],function(a){e[a]=function(c){return new e(b.extend({id:"reminder-"+a,text:c},f[a]))}}),e}.apply(b,d))&&(a.exports=e)},37:function(a,b,c){var d,e;d=[c(6),c(38),c(9),c(10),c(12),c(39),c(43),c(44)],void 0!==(e=function(a,b,c,d,e,f,g,h){var i="http://help.douban.com/help/ask?category=book&type=43",j=function(b){this._el=b,this.tmplPurchaseDialog=a("#tmpl-purchase-dialog").html(),this.tmplPurchaseSuccess=a("#tmpl-purchase-success").html()};return a.extend(j.prototype,h,{doPurchase:function(){this.checkBalance()},onReadyToBuy:function(a,b,c,h){if(this.isFree())return void this.buyAsFree();var i=this,j=this._readablePrice(h.amount),k=this._readablePrice(h.rest),l=this._readablePrice(h.balance),m=this.getUsername(),n="购买"+this.getKindName(),o=this.isPrivate(),p=f({type:"confirm",title:n,content:e(this.tmplPurchaseDialog,{title:this.getTitle(),extra_title:this.getExtraTitle(),price:j,amount:k,balance:l,consumptions:h.bill,username:m,secretly:o,subscribed:this.isSubscribed(),isChapter:this.isChapter(),moneyformat:function(a){return a.toFixed(2)}})}).on("confirm",function(){var a=this.getBody(),b=a.find("[name=secretly]");i.addSubscription=a.find("[name=add_subscription]").is(":checked")?"on":"",b.prop("checked")?(i.secretly=b.val(),d("pp",1,{"max-age":31536e4})):(i.secretly="",d.remove("pp")),i.getBought(k),this.close(!0)}).addClass("purchase-dialog").on("close",function(){i._el.trigger("purchase:failed"),i.cancel()}).open();g.init({el:p.el.find(".payment-channels")}),this.paymentForm=g.form},onBought:function(){this.isFree()?location.reload():this.showSuccessDialog()},onCheckingBalance:function(){if(this.isFree())return void this.passedCheck();this.trackPurchaseEvent("tryToBuy"),this._checkBalance()},ongetBought:function(a,b,c,d){d?this._confirmThirdPartyToBuy(d):this._confirmToBuy()},onbuyAsFree:function(){this._confirmToBuy()},showSuccessDialog:function(){var a,b=this,c=this.tmplPurchaseSuccess,d=3,g=this.isMultiPurchase(),h=e(c,{sec:d,isMultiPurchase:g});a=g?f({type:"tips",title:"购买成功",content:h}).setButtons([{text:"知道了"}]):f({type:"confirm",title:"购买成功",content:h}).setButtons([{text:"去阅读"},{text:"知道了"}]),a.addClass("purchase-success-dialog").on("close",function(){clearInterval(j),b._el.trigger("purchase:finish",b.getRedirectUrl())}).on("confirm",function(){b.isMultiPurchase()?location.href=b.getRedirectUrl():location.href=b.getReaderUrl()}).on("cancel",function(){this.close()}).open();var i=a.el.find(".count-down-num")[0];i.innerHTML=d;var j=setInterval(function(){d-=1,i.innerHTML=d,d||(clearInterval(j),a.close())},1e3)},onsucceededToBuy:function(a,b,c,d){this.isFree()?this.trackPurchaseEvent("got"):(this.trackPurchaseEvent("bought"),this.trackEcommerce(d.order,this.getOrigin(),"购买")),this._el.trigger("purchase:success")},onfailedToBuy:function(){this.trackPurchaseEvent("failed"),this._el.trigger("purchase:failed")},_readablePrice:function(a){return a/100},_readableAmount:function(a){return a<0?Math.abs(a)/100:0},_checkBalance:function(){var a=this;this._el.trigger("checkBalance:start"),c.get("/j/bill?works_ids="+this.getWorksIds().join(",")).done(function(b){a.passedCheck(b)}).fail(function(){a._el.trigger("checkBalance:failed"),a.trackPurchaseEvent("checkBalanceFailed"),f({type:"confirm",title:"出错了",content:"无法获取账户余额，也许是网络连接出现了问题。"}).setButtons([{text:"重试"},{text:"问题反馈"}]).on("confirm",function(){this.close(!0),a._checkBalance()}).on("cancel",function(){window.open(i)}).on("close",function(){a.failedCheck()}).open()})},_confirmThirdPartyToBuy:function(a){var b=this;f({type:"confirm",title:"等待支付",content:"请在新打开的页面中完成支付。",closable:!1}).addClass("general-tips").setButtons([{text:"支付成功"},{text:"遇到问题"}]).on("confirm",function(){location.reload()}).on("cancel",function(){b._el.trigger("bought:failed"),b.failedToBuy(),window.open(i)}).open(),this._requestThirdPartyToBuy(a)},_requestThirdPartyToBuy:function(b){var c=[{name:"amount",value:b},{name:"secretly",value:this.secretly},{name:"add_subscription",value:this.addSubscription}];c.push.apply(c,a.map(this.getWorksIds(),function(a){return{name:"works_ids",value:a}}));for(var d=c.length;d;)d-=1,this.paymentForm.append(a("<input>",{type:"hidden"}).attr(c[d]));this.paymentForm.submit()},_requestToBuy:function(){var b=this.isFree()?"获取作品":"确认购买",d="正在{{EVENT}}，请稍候...".replace("{{EVENT}}",b),e=f({type:"tips",title:b,content:d}).addClass("general-tips").open();return c({type:"POST",url:"/j/article/buy",dataType:"json",arkWithDocReferer:!0,data:a.param({works_ids:this.getWorksIds(),secretly:this.secretly||"",add_subscription:this.addSubscription},!0)}).always(function(){e.close()})},_confirmToBuy:function(){var a=this;a._requestToBuy().done(function(b){!b||b.r?a._confirmToBuyFailed(b?b.err:"出现了奇怪的错误:("):a.succeededToBuy(b)}).fail(function(){a._confirmToBuyFailed("无法完成购买操作，也许是网络连接出现了问题。")})},_confirmToBuyFailed:function(a){var b=this;this.trackPurchaseEvent("finalPurchaseFailed"),f({type:"confirm",title:"出错了",content:a}).setButtons([{text:"重试"},{text:"问题反馈"}]).on("confirm",function(){this.close(!0),b._confirmToBuy()}).on("cancel",function(){window.open(i)}).on("close",function(){b.failedToBuy()}).addClass("general-tips").open()},isFree:function(){return!this.getPriceInCents()},isPrivate:function(){return!!d("pp")},isSubscribed:function(){return!!this._el.data("subscribed")},isChapter:function(){return this._el.data("is-chapter")},getPrice:function(){return this._el.data("readable-price")},getPriceInCents:function(){return this._el.data("price")},getTitle:function(){return this._el.data("title")},getExtraTitle:function(){return this._el.data("extra-title")},getKindName:function(){return this._el.data("kind-name")},getWorksIds:function(){return(this._el.data("works-ids")+"").split(",")},isMultiPurchase:function(){return!!this._el.data("is-multiply")},getArticleUrl:function(){return this._el.data("url")},getReaderUrl:function(){return this._el.data("reader-url")},getRedirectUrl:function(){return this._el.data("redirect-url")},getUsername:function(){return this._el.data("username")},getOrigin:function(){var a=/^\/(reader|\w*)/gi.exec(location.pathname)[1];return"reader"===a?a:"new-store"},isLargeBtn:function(){return this.isLargeBtn=this._el.data("is-large-btn"),this.isLargeBtn}}),b.create({target:j.prototype,events:[{name:"checkBalance",from:"none",to:"CheckingBalance"},{name:"passedCheck",from:"CheckingBalance",to:"ReadyToBuy"},{name:"failedCheck",from:"CheckingBalance",to:"none"},{name:"getBought",from:"ReadyToBuy",to:"Buying"},{name:"succeededToBuy",from:"Buying",to:"Bought"},{name:"cancel",from:"ReadyToBuy",to:"none"},{name:"failedToBuy",from:"Buying",to:"none"},{name:"buyAsFree",from:"ReadyToBuy",to:"Buying"}]}),j.applyWithIn=function(b,c){a(c).find(b).each(function(b,c){new j(a(c))})},j}.apply(b,d))&&(a.exports=e)},38:function(a,b,c){!function(){var c={VERSION:"2.3.5",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,PENDING:4},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300},WILDCARD:"*",ASYNC:"async",create:function(a,b){var d="string"==typeof a.initial?{state:a.initial}:a.initial,e=a.terminal||a.final,f=b||a.target||{},g=a.events||[],h=a.callbacks||{},i={},j={},k=function(a){var b=a.from instanceof Array?a.from:a.from?[a.from]:[c.WILDCARD];i[a.name]=i[a.name]||{};for(var d=0;d<b.length;d++)j[b[d]]=j[b[d]]||[],j[b[d]].push(a.name),i[a.name][b[d]]=a.to||b[d]};d&&(d.event=d.event||"startup",k({name:d.event,from:"none",to:d.state}));for(var l=0;l<g.length;l++)k(g[l]);for(var m in i)i.hasOwnProperty(m)&&(f[m]=c.buildEvent(m,i[m]));for(var m in h)h.hasOwnProperty(m)&&(f[m]=h[m]);return f.current="none",f.is=function(a){return a instanceof Array?a.indexOf(this.current)>=0:this.current===a},f.can=function(a){return!this.transition&&(i[a].hasOwnProperty(this.current)||i[a].hasOwnProperty(c.WILDCARD))},f.cannot=function(a){return!this.can(a)},f.transitions=function(){return j[this.current]},f.isFinished=function(){return this.is(e)},f.error=a.error||function(a,b,c,d,e,f,g){throw g||f},d&&!d.defer&&f[d.event](),f},doCallback:function(a,b,d,e,f,g){if(b)try{return b.apply(a,[d,e,f].concat(g))}catch(b){return a.error(d,e,f,g,c.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function",b)}},beforeAnyEvent:function(a,b,d,e,f){return c.doCallback(a,a.onbeforeevent,b,d,e,f)},afterAnyEvent:function(a,b,d,e,f){return c.doCallback(a,a.onafterevent||a.onevent,b,d,e,f)},leaveAnyState:function(a,b,d,e,f){return c.doCallback(a,a.onleavestate,b,d,e,f)},enterAnyState:function(a,b,d,e,f){return c.doCallback(a,a.onenterstate||a.onstate,b,d,e,f)},changeState:function(a,b,d,e,f){return c.doCallback(a,a.onchangestate,b,d,e,f)},beforeThisEvent:function(a,b,d,e,f){return c.doCallback(a,a["onbefore"+b],b,d,e,f)},afterThisEvent:function(a,b,d,e,f){return c.doCallback(a,a["onafter"+b]||a["on"+b],b,d,e,f)},leaveThisState:function(a,b,d,e,f){return c.doCallback(a,a["onleave"+d],b,d,e,f)},enterThisState:function(a,b,d,e,f){return c.doCallback(a,a["onenter"+e]||a["on"+e],b,d,e,f)},beforeEvent:function(a,b,d,e,f){if(!1===c.beforeThisEvent(a,b,d,e,f)||!1===c.beforeAnyEvent(a,b,d,e,f))return!1},afterEvent:function(a,b,d,e,f){c.afterThisEvent(a,b,d,e,f),c.afterAnyEvent(a,b,d,e,f)},leaveState:function(a,b,d,e,f){var g=c.leaveThisState(a,b,d,e,f),h=c.leaveAnyState(a,b,d,e,f);return!1!==g&&!1!==h&&(c.ASYNC===g||c.ASYNC===h?c.ASYNC:void 0)},enterState:function(a,b,d,e,f){c.enterThisState(a,b,d,e,f),c.enterAnyState(a,b,d,e,f)},buildEvent:function(a,b){return function(){var d=this.current,e=b[d]||b[c.WILDCARD]||d,f=Array.prototype.slice.call(arguments);if(this.transition)return this.error(a,d,e,f,c.Error.PENDING_TRANSITION,"event "+a+" inappropriate because previous transition did not complete");if(this.cannot(a))return this.error(a,d,e,f,c.Error.INVALID_TRANSITION,"event "+a+" inappropriate in current state "+this.current);if(!1===c.beforeEvent(this,a,d,e,f))return c.Result.CANCELLED;if(d===e)return c.afterEvent(this,a,d,e,f),c.Result.NOTRANSITION;var g=this;this.transition=function(){return g.transition=null,g.current=e,c.enterState(g,a,d,e,f),c.changeState(g,a,d,e,f),c.afterEvent(g,a,d,e,f),c.Result.SUCCEEDED},this.transition.cancel=function(){g.transition=null,c.afterEvent(g,a,d,e,f)};var h=c.leaveState(this,a,d,e,f);return!1===h?(this.transition=null,c.Result.CANCELLED):c.ASYNC===h?c.Result.PENDING:this.transition?this.transition():void 0}}};void 0!==a&&a.exports&&(b=a.exports=c),b.StateMachine=c}()},39:function(a,b,c){var d,e;d=[c(6),c(40),c(41)],void 0!==(e=function(a,b,c){function d(d){c.call(this);var e=this;this.opts=d,this.el=a(f),this.text=this.el.find(".k-text"),this.head=this.el.find(".dialog-hd"),this.buttons=this.el.find(".k-buttons"),this.btnClose=this.el.find(".k-close"),this.closable=void 0===d.closable||!!d.closable,this.overlay=b({closable:this.closable,klass:d.overlayClass}),this.render(),g.on("click.close-"+this.overlay.id,".k-close",function(){e.close()}),this.el.on("click.confirm","[data-confirm]",function(b){var c=!!a(b.currentTarget).data("confirm");e.emit(c?"confirm":"cancel"),c||e.close()}),this.overlay.on("close",function(){e.emit("close")})}function e(a){return a=a||{},new e.Dialog(a)}var f='<div id="ark-dialog"><div class="dialog-hd"><a href="javascript:;" class="k-close">&times;</a></div><div class="dialog-bd"><div class="k-text"></div><div class="k-buttons"></div></div></div>',g=a(document);return a.extend(d.prototype,{render:function(){var a=this.opts.title,b=this.opts.foot;this.text.html(this.opts.content),this.closable||this.btnClose.remove(),a&&this.setTitle(a),b&&this.setFoot(b),this.setButtons(),this.overlay.setBody(this.el)},setTitle:function(b){return this.head.prepend(a("<span>",{class:"k-title",text:b})),this},setFoot:function(b){return this.el.append(a("<div>",{class:"dialog-ft",html:b})),this},setButtons:function(b){b=b||[];var c=this.opts.type,d=["确定","取消"],e=b.length;if(/confirm|tips/i.test(c)){this.buttons[0].innerHTML='<button class="btn btn-large" type="button"data-confirm="1">确定</button><button class="btn btn-minor btn-large" type="button"data-confirm="0">取消</button>';for(var f=this.buttons.find("button"),g=0;g<e;g++)f.eq(g).text(b[g].text||d[g]).addClass(b[g].class||"");"tips"===c&&a(f[1]).remove()}return"custom"===c&&(this.buttons[0].innerHTML=b),this},getBody:function(){return this.overlay.getContentElement()},setBody:function(a){return this.getBody().find(".k-text").html(a),this},addClass:function(a){return this.el.addClass(a),this},open:function(){return this.overlay.open(),this.emit("open"),this},close:function(a){return this.el.off(".confirm"),this.overlay.close(a),this}}),c(d.prototype),e.Dialog=d,e}.apply(b,d))&&(a.exports=e)},40:function(a,b,c){var d,e;d=[c(6),c(41)],void 0!==(e=function(a,b){function c(){return"overlay-"+i++}function d(d){if(b.call(this),this.opts=d,this.el=a(f).appendTo("body"),this.body=this.el.find(".k-slave"),this.closable=void 0===d.closable||!!d.closable,this.setBody(),this.el.addClass(d.klass),this.id=c(),this.closable){var e=this;g.on("click.close-"+this.id,"#ark-overlay",function(a){a.target===a.currentTarget&&e.close()}).on("keyup",function(a){var b=a.target.tagName,c=27===a.keyCode;!/input|textarea/i.test(b)&&c&&e.close()})}}function e(a){return a=a||{},new e.Overlay(a)}var f='<div id="ark-overlay" class="hide"><div class="k-stick"></div><div class="k-content"><div class="k-slave"></div></div></div>',g=a(document),h=a("html"),i=0;return a.extend(d.prototype,{close:function(a){return this.el.remove(),h.removeClass("ark-overlay"),g.off(".close-"+this.id),a||this.emit("close"),this},getContentElement:function(){return this.el.find(".k-content")},open:function(){return this.scrollTop=g.scrollTop(),h.addClass("ark-overlay"),this.el.removeClass("hide"),this.emit("open"),this},setBody:function(a){return a=a||this.opts.body,this.body.html(a),this}}),b(d.prototype),e.Overlay=d,e}.apply(b,d))&&(a.exports=e)},41:function(a,b,c){var d,e;d=[c(42)],void 0!==(e=function(a){function b(c){if(c)return a.extend(c,b.prototype)}return b.prototype.on=b.prototype.bind=function(b,c){return 1===arguments.length?(a.each(b,function(a,b){this.on(b,a)},this),this):(this._callbacks=this._callbacks||{},(this._callbacks[b]=this._callbacks[b]||[]).push(c),this)},b.prototype.emit=b.prototype.trigger=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;d<e;++d)c[d].apply(this,b)}return this},b}.apply(b,d))&&(a.exports=e)},42:function(a,b,c){var d,e;d=[],void 0!==(e=function(){var a={},b=Array.prototype,c=b.forEach,d=b.slice,e=a.each=function(a,b,d){if(a)if(c&&a.forEach===c)a.forEach(b,d);else if(a.length===+a.length)for(var e=0,f=a.length;e<f;e++)b.call(d,a[e],e,a);else for(var g in a)a.hasOwnProperty(g)&&b.call(d,a[g],g,a)};return a.isArray=Array.isArray||function(a){return"[object Array]"==={}.toString.call(a)},a.filter=function(a,c,d){var f=[];return b.filter?a.filter(c,d):(e(a,function(b,e){c.call(d,b,e,a)&&f.push(b)}),f)},a.extend=function(a){return e(d.call(arguments,1),function(b){for(var c in b)a[c]=b[c]}),a},a.escape=function(a){a=""+a||"";var b={"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"};return a.replace(/[<>&'"]/g,function(a){return b[a]})},a.unescape=function(a){a=""+a||"";var b={"&amp;":"&","&lt;":"<","&gt;":">","&#39;":"'","&quot;":'"'};return a.replace(/(&amp;|&lt;|&gt;|&#39;|&quot;)/g,function(a){return b[a]})},a.now=Date.now||function(){return(new Date).getTime()},a.debounce=function(b,c,d){var e,f,g,h,i,j=function j(){var k=a.now()-h;k<c?e=setTimeout(j,c-k):(e=null,d||(i=b.apply(g,f),g=f=null))};return function(){g=this,f=arguments,h=a.now();var k=d&&!e;return e||(e=setTimeout(j,c)),k&&(i=b.apply(g,f),g=f=null),i}},a.throttle=function(b,c,d){var e,f,g,h=null,i=0;d=d||{};var j=function(){i=!1===d.leading?0:a.now(),h=null,g=b.apply(e,f),e=f=null};return function(){var k=a.now();i||!1!==d.leading||(i=k);var l=c-(k-i);return e=this,f=arguments,l<=0?(clearTimeout(h),h=null,i=k,g=b.apply(e,f),e=f=null):h||!1===d.trailing||(h=setTimeout(j,l)),g}},a}.apply(b,d))&&(a.exports=e)},43:function(a,b,c){var d,e;d=[c(6),c(9),c(12)],void 0!==(e=function(a,b,c){return{init:function(a){return this.el=a.el,this.render(),this},template:a("#tmpl-payment-channels").html(),render:function(){return this.el.find(".content").html(c(this.template)),this.form=this.el.find(".payment-form"),this}}}.apply(b,d))&&(a.exports=e)},44:function(a,b,c){var d,e;d=[c(45)],void 0!==(e=function(a){return{trackPurchaseEvent:function(b){var c=this.isChapter()?"column-purchase":"purchase";a.trackEvent(c,b,this.getTitle(),this.getPriceInCents())},trackEcommerce:function(b,c,d){var e=this.getPrice();a.trackEcommerce({id:b,affiliation:c,revenue:e},{id:b,sku:this.getWorksIds()[0],name:this.getTitle(),category:d||"",price:e,quantity:1})}}}.apply(b,d))&&(a.exports=e)},45:function(a,b,c){var d,e;d=[],void 0!==(e=function(){var a={},b=Array.prototype.slice;return a.trackPageview=function(a){ga("send","pageview",a.replace(/^(\/*)/g,"/"))},a.trackEvent=function(a,c){var d=b.call(arguments,2),e=["send","event",a,c];d.length>0&&("number"==typeof d[0]&&(d[0]=d[0].toString()),"string"==typeof d[1]&&(d[1]=+d[1]),e=e.concat(d)),ga.apply(this,e)},a.trackEcommerce=function(a,b){ga("ecommerce:addTransaction",a),ga("ecommerce:addItem",b),ga("ecommerce:send")},a.delayRun=function(a){!function(){setTimeout(a,400)}()},a}.apply(b,d))&&(a.exports=e)},46:function(a,b,c){var d,e;d=[c(20),c(3),c(24),c(47)],void 0!==(e=function(a,b,c,d){function e(a,b){return a*(/ebook|gallery/.test(b)?100:1)}function f(f,h){var i=new d,j=f.toJSON(),k=f.get("type")||g[a.works.type],l=e(+f.get("price"),k),m=e(+f.get("fixedPrice"),k),n="column"===k,o=f.get("is_subscribed"),p=f.get("has_finished"),q=n?"chapter/"+j.chapters[0].id+"/":"",r=["",n?k:"ebook",f.get("id"),q].join("/"),s="/reader"+r,t=b.extend(j,{url:r,redirect_url:s,price:l,fixedPrice:m,is_large_btn:!0,is_hollow_btn:!1,is_subscribed:p||o,is_mobile_direct_purchase:c.fitForMobile(),type:k},h||{});return n&&(t.id=j.identity),i.render({data:t})}var g={t:"ebook",g:"gallery"};return f}.apply(b,d))&&(a.exports=e)},47:function(a,b,c){var d,e;d=[c(2),c(3),c(6),c(10),c(20)],void 0!==(e=function(a,b,c,d,e){function f(a){return(a/100).toFixed(2)}var g={ebook:"图书",gallery:"画册",chapter:"篇目"};return a.View.extend({mobileTmpl:c("#tmpl-mobile-purchase-button").html(),btnWrapperTmpl:c("#tmpl-purchase-button-wrapper").html(),btnInnerTmpl:c("#tmpl-purchase-button-inner").html(),className:"action-button",render:function(a){var c=a.data,d=e.me.isAnonymous,h="column"===c.type?"整部"+c.kind:g[c.type];return b.defaults(c,{kind_name:h,widget:c.asGift?"purchase-as-gift":"faster-purchase",readable_price:f(c.price),readable_fixed_price:f(c.fixedPrice),username:e.me.name,isAnonymous:d,is_mobile_direct_purchase:!1,isLightBtn:!1}),c.is_mobile_direct_purchase?this.renderModileButton(c):this.renderDesktopButton(c),this},renderModileButton:function(a){var c,e=d("page_style");c=e&&"web"===e?"/account/?about_to_buy={{- id}}":"/purchase/?about_to_buy={{- id}}",a.mobile_direct_purchase_url=b.template(c,a),this.setElement(b.template(this.mobileTmpl,a))},renderDesktopButton:function(a){var c=b.template(this.btnInnerTmpl,a);a.isAnonymous?this.$el.html(c):(this.setElement(b.template(this.btnWrapperTmpl,a)),this.$el.append(c))}})}.apply(b,d))&&(a.exports=e)},48:function(a,b,c){var d,e;d=[c(3),c(6),c(20),c(21),c(9),c(24),c(39),c(36)],void 0!==(e=function(a,b,c,d,e,f,g,h){function i(b){a.bindAll(this,"addToBookshelf","handleAddToBookshelf"),this.aid=b.aid,this.title=b.title,this.wrapper=b.wrapper,this.placeholderSel=b.placeholderSel,this.isAnonymous=c.me.isAnonymous,this.success=b.success,this.wrapper.on("click",l,this.handleAddToBookshelf)}var j=b("#tmpl-added-status").html(),k=b("#tmpl-add-to-bookshelf").html(),l=".lnk-collect",m=b("#tmpl-add-to-bookshelf-confirm").html();return a.extend(i.prototype,{render:function(){this.wrapper.find(this.placeholderSel).html(a.template(k,{isAnonymous:c.me.isAnonymous,loginUrl:c.DOUBAN+"/accounts/login?redir="+location.href,fitForMobile:f.fitForMobile(),isWeixin:f.isWeixin()}))},handleAddToBookshelf:function(){var b=this;g({title:"领取"+this.getKindName(),content:a.template(m,{title:this.title,username:c.me.name}),type:"confirm"}).addClass("purchase-dialog").open().on("confirm",function(){var a=this.text.find("[name=secretly]").is(":checked");b.addToBookshelf(b.aid,a),this.close()})},addToBookshelf:function(c,d){if(!this.isAnonymous){var f=this.wrapper.find(l),g=(f.text(),a.now()),i=this;h.toast("领取中..."),e.post("/j/receive/",{works_id:c,is_secretly:0|d}).done(function(c){var d=c.err;d?h.toast(d):a.delay(function(){var a=f.closest(".btn-adding-wrapper"),c=b(j).hide();h.toast("领取成功"),a.replaceWith(c),c.fadeIn(300),i.success&&i.success()},600-(a.now()-g))}).fail(function(){h.toast("出现了奇怪的错误，请稍后再试")})}},getKindName:function(){return c.works.isChapter?d.getModel("column").get("kind"):"图书"}}),i.apply=function(a){return new i(a)},i}.apply(b,d))&&(a.exports=e)},49:function(a,b,c){var d,e,f=Object.assign||function(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a};d=[c(6),c(2),c(3),c(20),c(9),c(52),c(50),c(53),c(55),c(56),c(58)],void 0!==(e=function(a,b,c,d,e,g,h,i,j,k,l){function m(b){var c=document.documentElement.clientHeight;a(window).scrollTop(b.offset().top-c/3*2)}function n(){return l.openLoginAndSignup(),!1}var o=b.View.extend({pageLimit:5,currPageIndex:0,className:"chapter-comments",tmpl:a("#tmpl-chapter-comments").html(),tmplComment:a("#tmpl-chapter-comment-item").html(),tmplRefField:a("#tmpl-comment-ref-field").html(),events:{"submit .comment-form":"submitComment","click .next":"clickTurnPage","click .prev":"clickTurnPage","click .page-num":"clickPageNum","focus [name=text]":"unfoldForm","click .ref-del":"removeRefField"},initialize:function(a){this.commentTargetInfo=a.commentTargetInfo,this.commentsUrl=a.commentsUrl,this.render(),this.loadComments()},render:function(){return this.$el.html(this.tmpl),this.countEl=this.$(".hd .count"),this.form=this.$(".comment-form"),h.ctrlEnterForm(this.form),this.commentsList=this.$(".comments-list"),this.paginator=this.$(".paginator"),this},loadComments:function(){var a=this,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e({type:"get",url:this.commentsUrl,data:{limit:this.pageLimit,start:b*this.pageLimit}}).then(function(d){if(a.currPageIndex=b,a.totalPages=a.getPagesCount(d.total),c&&b!==a.totalPages-1)return void a.loadComments(a.totalPages-1);a.updateTotalComments(d.total),a.totalPages>1?a.paginator.html(j.renderPaginator({currPageIndex:a.currPageIndex,pageCount:a.totalPages})):a.paginator.empty(),a.commentsList.empty(),d.data.forEach(function(b){b=a.adaptCommentData(b),a.appendCommentModel(new i(b,{url:"/j/article_v2/comment/"+b.id+"/"}))}),c&&m(a.commentsList.find("li:last-child"))})},getPagesCount:function(a){return Math.ceil(a/this.pageLimit)},updateTotalComments:function(a){this.totalComments=a,this.countEl.text(a).show()},adaptCommentData:function(a){return f({},a,{author:{user_id:a.author_id,avatar:a.author_picture,url:"/people/"+a.author_id+"/",name:a.author_name},isArticleAuthor:this.commentTargetInfo.article.authorId===a.author_id,ref_comment:a.ref_comment&&this.adaptCommentData(a.ref_comment),time:g.sec2date(a.created_time)})},appendCommentModel:function(a){var b=this,c=new k({model:a,tmpl:this.tmplComment,targetInfo:this.commentTargetInfo});this.listenTo(c,"reply",this.replyComment),this.listenTo(c,"removed",function(){b.updateTotalComments(b.totalComments-1)}),this.commentsList.append(c.render().el)},submitComment:function(b){var c=this;b.preventDefault();var d=a(b.target),f={};d.serializeArray().forEach(function(a){f[a.name]=a.value}),f.text.trim().length&&!this.formDisabled&&(this.formDisabled=!0,d.addClass("loading"),new i(f,{urlRoot:this.commentsUrl}).save().done(function(){var a=d.find("[name=text]");a.val(""),a.blur(),c.form.addClass("is-folded"),c.refField&&c.removeRefField(),c.loadComments(c.getPagesCount(c.totalComments+1)-1,!0)}).always(function(){c.formDisabled=!1,d.removeClass("loading")}).fail(function(a){if(a instanceof e.HasBannedWordsError)return alert(a.message);alert("遇到的奇怪的错误，请稍后再试")}))},clickTurnPage:function(b){var c=a(b.target);c.hasClass("disabled")||this.loadComments(this.currPageIndex+(c.hasClass("prev")?-1:1))},clickPageNum:function(b){var c=a(b.target);c.hasClass("disabled")||this.loadComments(c.data("index"))},unfoldForm:function(){this.form.removeClass("is-folded")},replyComment:function(b){this.removeRefField(),this.refField=a(c.template(this.tmplRefField,b.toJSON())),this.form.prepend(this.refField),this.form.find("[name=text]").focus()},removeRefField:function(){this.refField&&(this.refField.remove(),delete this.refField)}}),p={};return d.me.isAnonymous&&(o.prototype.events["focus [name=text]"]="focusInput",c.each(["submitComment","focusInput","replyComment"],function(a){p[a]=n})),c.extend(o.prototype,p),o}.apply(b,d))&&(a.exports=e)},50:function(a,b,c){var d,e;d=[c(6),c(51)],void 0!==(e=function(a,b){function c(a){return a.height(0).scrollTop(0).scrollTop(1e4).scrollTop()}var d={};return d.toDict=function(a){for(var b,c={},d=a.serializeArray(),e=0;e<d.length;e++)b=d[e],c[b.name]=b.value;return c},d.send=function(b,c){var e=d.toDict(b),f=b.attr("method"),g=b.attr("action");return a.ajax(a.extend({type:f,url:g,data:e},c))},d.readonlyForm=function(a){a.find("input, button, textarea").prop("disabled",!0)},d.resumeForm=function(a){a.find("input, button, textarea").prop("disabled",!1)},d.ctrlEnterForm=function(c){if(c=c.eq(0),!c.data("ctrl-enter-binded")){c.data("ctrl-enter-binded",!0);var d=c.find("textarea"),e=d.data("key-router")||b({target:d});e.down(["ctrl+enter","meta+enter"],function(){a(this.form).submit()}),d.data("key-router",e)}},d.autoResize=function(a){var b=a.data("fake-textarea");if(b&&!a.data("has-expanded-max-height")){var d=a.val();b.val(d);var e=c(b),f=a.data("max-height")||100,g=a.data("min-height")||a.height();e>f&&(e=f,a.css({overflow:"auto"}).data("has-expanded-max-height",!0)),a.height(e<g?g:e)}},d.enableAutoResize=function(b,c){var e=b.clone();e.removeProp("name"),c=c||b.parent(),b.data("fake-textarea",e),b.on("input propertychange",a.proxy(function(a){if(a&&a.originalEvent){var c=a.originalEvent.propertyName;if(c&&"value"!==c)return}d.autoResize(b)},this)),e.css({position:"absolute",top:"-999px",left:0}),c.append(e)},d}.apply(b,d))&&(a.exports=e)},51:function(a,b,c){var d,e;d=[c(6)],void 0!==(e=function(a){function b(a){var b="keypress"!==a.type&&d[a.which],c=String.fromCharCode(a.which).toLowerCase(),f="",g={};if(a.altKey&&"alt"!==b&&(f+="alt+"),a.ctrlKey&&"ctrl"!==b&&(f+="ctrl+"),a.metaKey&&!a.ctrlKey&&"meta"!==b&&(f+="meta+"),a.shiftKey&&"shift"!==b&&(f+="shift+"),b)g[f+b]=!0;else{var h=f+c;h&&(g[h]=!0),(h=e[c])&&(g[f+h]=!0,"shift+"===f&&(h=e[c])&&(g[h]=!0))}return g}function c(c){c=c||{};var d=this;this.target=c.target||document,this.event=c.event||"keydown",this.keyHandlers={},this.rules=[],this.sequence={},this.sequenceNums=[],this.history=[],this._handler=function(a){if(this!==a.target&&(/textarea|select/i.test(a.target.nodeName)||"text"===a.target.type))return!0;var c=d.keyHandlers[d.event];if(!c)return!0;var e,f,g,h=b(a);if(!d.lock&&d.check(this,a)){for(g in h)if(e=c[g])break;if(d.sequenceNums.length){var j=d.history;if(j.push(g),j.length>10&&j.shift(),j.length>1)for(var k=d.sequenceNums.length-1;k>=0;k--)if(f=c[j.slice(0-d.sequenceNums[k]).join("->")])return f.apply(this,arguments),j.length=0,!1}e&&e.apply(this,arguments)}},a(this.target).on(this.event,this._handler)}var d={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},e={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":":","'":'"',",":"<",".":">","/":"?","\\":"|"};return c.prototype={addHandler:function(b,c,d){function e(a){var b=a.split("->");if(b.length>1){f.sequence[b.length]=1;var c=[];for(var e in f.sequence)c.push(parseInt(e,10));f.sequenceNums=c.sort(function(a,b){return a-b})}g[a.toLowerCase()]=d}var f=this,g=this.keyHandlers[b];return g||(g=this.keyHandlers[b]={}),a.isArray(c)?a.each(c,function(a,b){e(b)}):e(c),this},reset:function(){a(this.target).off(this.event,this._handler),this.keyHandlers={},this.rules=[],this.history=[],delete this._handler,this.lock=!1},addRule:function(a){return this.rules.push(a),this},enable:function(){this.lock=!1},disable:function(){this.lock=!0},check:function(a,b){for(var c=!0,d=this.rules,e=0,f=d.length;e<f;e++)if(!d[e].call(a,b)){c=!1;break}return c}},a.each(["down","up","press"],function(a,b){c.prototype[b]=function(a,c){return this.addHandler("key"+b,a,c),this}}),function(a){return new c(a)}}.apply(b,d))&&(a.exports=e)},52:function(a,b,c){var d;void 0!==(d=function(){var a=function(a){var b=+new Date,c=b-a,d=Math.floor(c/864e5);if(!(d>2)){var e=Math.floor(c/1e3);if(e<180)return"刚刚";var f=Math.floor(e/60);if(f<60)return f+"分钟前";var g=Math.floor(f/60);return g<24?g+"小时前":d+"天前"}};return{sec2date:function(b,c){c=c||{},c.dateFromNow=c.dateFromNow||!0,c.withoutYear=c.withoutYear||!1;var d=new Date(1e3*b),e="";if(c.dateFromNow){var f=a(d);if(f)return f}return c.withoutYear||(e=d.getFullYear()+"-"),e+=d.getMonth()+1+"-"+d.getDate()}}}.call(b,c,b,a))&&(a.exports=d)},53:function(a,b,c){var d,e;d=[c(2),c(3),c(54)],void 0!==(e=function(a,b,c){return a.Model.extend({urlRoot:function(){return this.collection&&this.collection.url},sync:function(){return c.apply(this,arguments)},initialize:function(a,c){b.extend(this,b.pick(c,"url","urlRoot"))}})}.apply(b,d))&&(a.exports=e)},54:function(a,b,c){"use strict";var d=c(2),e=c(3),f=c(9);a.exports=function(a,b,c){return-1===["create","update","patch"].indexOf(a)?d.Model.prototype.sync.apply(this,arguments):f.censorThenRequest("post",e.result(b,"url"),c.attrs||b.toJSON(c),c,"json")}},55:function(a,b,c){var d,e;d=[c(6),c(3),c(2)],void 0!==(e=function(a,b,c){function d(a){a=b.defaults(a||{},h),this.limit=a.limit,this.setItems(a.items)}function e(a,b,c){var d=b-Math.floor(c/2),e=d+c,f=a.length,g=d<0?-d:0,h=e>f?e-f:0;return e+=g-h,d+=g-h,d=d<0?0:d,e=e>f?f:e,a.slice(d,e)}function f(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},d=c.currPageIndex,f=c.pageCount,g=c.pageNumTmpl,h=void 0===g?i.pageNumTmpl:g,j=c.prevTmpl,k=void 0===j?i.prevTmpl:j,l=c.nextTmpl,m=void 0===l?i.nextTmpl:l,n=c.aroundLimit,o=void 0===n?i.aroundLimit:n,p=c.edgeLimit,q=void 0===p?i.edgeLimit:p,r=a("<span>").addClass("page-nums"),s=b.range(0,f,1),t=e(s,d,o);return t=b.first(s,q).concat(t).concat(b.last(s,q)),t=b.uniq(t),b.each(t,function(b,c,e){var f=e[c-1];f&&b!==f+1&&r.append(a("<a>").addClass("ellipsis").text("…"));var g=a(h).data("index",b).text(b+1);b===d&&g.addClass("active disabled"),r.append(g)},this),[a(k).toggleClass("disabled",0===d),r,a(m).toggleClass("disabled",d>=f-1)]}function g(a){a=b.defaults(a||{},i),b.extend(this,a),this.paging=new d(b.pick(a,b.keys(h))),this.setItems(a.items),this.bindEvents()}var h={limit:10,items:[]};b.extend(d.prototype,{setItems:function(a){this.items=a,this.pages=[],this.curPageIndex=0,this.paging()},paging:function(){var a,b,c,d=Math.ceil(this.items.length/this.limit);for(a=0;a<d;a++)b=a*this.limit,c=(a+1)*this.limit,this.pages.push(this.items.slice(b,c))},getPage:function(a){return b.isUndefined(a)&&(a=this.curPageIndex),this.pages[a]},turnPage:function(a){return this.hasPage(a)?(this.curPageIndex=a,this.getPage(a)):this.getPage()},hasPage:function(a){return a>=0&&a<this.getPageCount()},getPageCount:function(){return this.pages.length}});var i={limit:10,items:[],aroundLimit:5,edgeLimit:2,container:a(),navContainer:a(),prevSelector:".prev",nextSelecotr:".next",pageNumSelector:".page-num",prevTmpl:'<a class="prev" href="#">&lt; 前页</a>',nextTmpl:'<a class="next" href="#">后页 &gt;</a>',pageNumTmpl:'<a class="page-num" href="#"></a>'};return b.extend(g.prototype,{setItems:function(a){return this.items=a,this.pages=[],this.paging.setItems(a),this},getCurPageIndex:function(){return this.paging.curPageIndex},bindEvents:function(){b.bindAll(this,"clickTurnPage","clickPageNum"),this.navContainer.on("click",this.prevSelector,this.clickTurnPage).on("click",this.nextSelecotr,this.clickTurnPage).on("click",this.pageNumSelector,this.clickPageNum)},render:function(){this.turnPage(this.getCurPageIndex())},renderNav:function(){if(this.navContainer.empty(),1!==this.paging.getPageCount()){var a=this.getCurPageIndex(),b=this.paging.getPageCount();this.navContainer.append(f({currPageIndex:a,pageCount:b}))}},toggleItems:function(c,d){b.each(c,function(b){a(b).toggle(d)})},clickTurnPage:function(b){b.preventDefault();var c,d=a(b.target);d.hasClass("disabled")||(c=d.hasClass("prev")?-1:1,this.turnPage(this.getCurPageIndex()+c))},clickPageNum:function(b){b.preventDefault();var c=a(b.target);c.hasClass("disabled")||this.turnPage(c.data("index"))},turnPage:function(a){this.trigger("turnPage",this.paging.turnPage(a)),this.renderNav()},remove:function(){this.pages=[],this.container.empty(),this.navContainer.empty()}}),b.extend(g.prototype,c.Events),g.PagingCore=d,g.renderPaginator=f,g}.apply(b,d))&&(a.exports=e)},56:function(a,b,c){var d,e;d=[c(6),c(2),c(3),c(20),c(21),c(57)],void 0!==(e=function(a,b,c,d,e,f){return b.View.extend({tagName:"li",className:"comment-item",tmpl:a("#tmpl-annotation-comment-item").html(),initialize:function(a){this.listenTo(this.model,"destroy",this.remove),a.tmpl&&(this.tmpl=a.tmpl),this.targetInfo=a.targetInfo},events:{"click .delete-comment":"deleteComment","click .reply-comment":"replyComment"},render:function(){var a=this.model.toJSON(),b=a.author.user_id;return a.isMine=b===d.me.id,a.isArticleAuthor=this.isArticleAuthor(b),a.isAnonymous=d.me.isAnonymous,a.isAdmin=d.me.isAdmin,this.$el.html(c.template(this.tmpl,c.extend({autoLink:f},a))),this},isArticleAuthor:function(a){return!(!this.targetInfo||!this.targetInfo.article)&&a===this.targetInfo.article.authorId},deleteComment:function(a){a.preventDefault(),confirm("确定要删除？")&&(this.model.destroy(),this.trigger("removed",this.model))},replyComment:function(a){a.preventDefault(),this.trigger("reply",this.model)}})}.apply(b,d))&&(a.exports=e)},57:function(a,b,c){var d,e;d=[c(3)],void 0!==(e=function(a){var b=/(^|[\s\n,\.;\:!?\[\]{}()\u4e00-\u9fa5\u3002\uff1f\uff01\uff0c\u3001\uff1b\uff1a\u201c\u201d\u2018\u2019\uff08\uff09\u300a\u300b\u3008\u3009\u3010\u3011\u300e\u300f\u300c\u300d\ufe43\ufe44\u3014\u3015\u2026\u2014\uff5e\ufe4f\uffe5]|<[^a]+(?:\s*[\w-]*?=['"].+?['"])*>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi;return function(c){var d=c.match(b);if(!d)return a.escape(c);for(var e=[],f=function(b,c,d){return d.length<30?c+'<span class="auto-linked"><a target="_blank" href="'+a.escape(d)+'">'+a.escape(d)+"</a></span>":c+'<span class="auto-linked"><a class="link-has-invisible" target="_blank" href="'+a.escape(d)+'">'+a.escape(d.substr(0,30))+'</a><span class="invisible-link">'+a.escape(d.substr(30))+"</span></span>"},g=0,h=d.length;g<h;g++){var i=d[g],j=c.indexOf(i);e.push(a.escape(c.substring(0,j))),e.push(i.replace(b,f)),c=c.substr(j+i.length)}return e.join("")+a.escape(c)}}.apply(b,d))&&(a.exports=e)},58:function(a,b,c){var d,e;d=[c(6),c(3),c(25),c(59)],void 0!==(e=function(a,b,c,d){var e={stamp:"loginStamp"},f=c.hasWebStorage();return{openLoginAndSignup:function(a){a=a||{},b.isObject(a.actions)&&f&&b.each(a.actions,function(a,b){sessionStorage[e[b]]=JSON.stringify(a)}),d(a)},getActionOnce:function(a){if(f){var b=this.getAction(a);return sessionStorage.removeItem(e[a]),b}},getAction:function(a){if(f){var b=sessionStorage[e[a]];return b?JSON.parse(b):void 0}}}}.apply(b,d))&&(a.exports=e)},59:function(a,b,c){var d,e;d=[c(6),c(3)],void 0!==(e=function(a,b){var d={context:"reader",closable:!0,referUrl:location.href},e=function(a){return a=b.defaults(a||{},d),function(b){document.cookie="refer_url="+a.referUrl+";domain=douban.com;path=/",new b(a)}};return function(a){(function(){var b=[c(60)];e(a).apply(null,b)}).call(this)}}.apply(b,d))&&(a.exports=e)},60:function(a,b,c){var d,e;d=[c(6),c(39)],void 0!==(e=function(a,b){var c={type:"login",closable:!0,action:""},d=function(b){a.extend(this,c,b),this.render()};return a.extend(d.prototype,{render:function(){this.dialog=b({content:this.getTmpl(),closable:this.closable}).addClass("dialog-login-and-signup").open();var a=this.dialog.el.find(".loading"),c=this.dialog.el.find("iframe");c.on("load",function(){c.show(),a.hide()})},getTmpl:function(){var a="signup"===this.type?"#popup_register":"",b=Ark.DOUBAN_LOGIN_POPUP_URL+"?source=ark";return this.action&&(b+="&from_login_action="+encodeURIComponent(this.action)),'<div class="loading">正在加载，请稍候…</div><iframe scrolling="no" frameborder="0" src="'+(b+=a)+'"></iframe>'}}),d}.apply(b,d))&&(a.exports=e)},61:function(a,b,c){var d,e;d=[c(6),c(3),c(20),c(21),c(24),c(9),c(62),c(65),c(66),c(67),c(46),c(74)],void 0!==(e=function(a,b,d,e,f,g,h,i,j,k,l,m){var n=new j;return{appendResponses:function(f,h){var j=a("#tmpl-responses").html();f.append(b.template(j,{isAnonymous:d.me.isAnonymous}));var k=new i({articleId:h.get("id")}),l=f.find("#like-it"),m=f.find(".like-count");k.on("change:liked",function(a,b){l.toggleClass("liked",!!b)}).on("change:n_like",function(a,b){m.attr("count",b).toggle(0!==b)}).fetch(),l.click(function(){if(d.me.isAnonymous)return void e.trigger("open:login-dialog");k.toggleFavor()});var n=f.find(".read-count");g({url:"/j/article/"+h.id+"/read_count"}).then(function(a){n.attr("count",parseInt(a,10)).show()}),c.e(3,function(){c(75)})},appendSharingButtons:function(c,e){if(c.length&&!c.find(".share-buttons").length){if("c"!==d.works.type||f.fitForMobile()){var g=a("#tmpl-sharing-buttons").html();c.append(b.template(g,{size:"large"}))}else this.appendResponses(c,e);new h({ga:{dcs:"read-reader"}})}},appendReviewSection:function(b,c,d){if(b.length&&!b.find(".rating-form").length){var f=new k({model:c.getRating()}),g=f.render().$el,h=a("<div>",{class:"review-container"});f.on("cancel",function(){f.renderForm()}),f.on("rating:changed linkEdit:clicked",function(){e.vent.trigger("open:ratingBubble",{editingMode:!0})}),h.append(g),this.appendReviewsLink(h,c,d),b.append(h)}},appendReviewsLink:function(b,c,d){function f(a){g.find("a").toggle(!!a).text(a)}var g=b.find(".reviews-link");b.length&&!g.length&&(g=a("<div>",{class:"reviews-link"}),g.html(a("<a>",{href:e.router.getReviewsUrl()})),b.append(g),f(d.get("n_reviews")),d.on("change:n_reviews",f))},appendPurchaseGuide:function(c,d){function f(){g.html(n.render({model:d}).el),g.find(".purchase-section").html(l(d).$el),b.delay(function(){e.utils.applyPurchaseWithIn("[data-widget=faster-purchase]",".purchase-guide")},0)}var g=c.find(".sample-text");c.length&&!g.length&&(g=a("<div>",{class:"sample-text"}),c.append(g),f(),d.off("change:price",null,this),d.on("change:price",f,this))},appendDonateBar:function(a,b){if(a.length&&!a.find(".donate").length){var c=m.initialize({works_id:b.attributes.id,page_type:"reader",inMobile:f.fitForMobile()}),d=c.render().$el;a.append(d)}}}}.apply(b,d))&&(a.exports=e)},62:function(a,b,c){var d,e;(function(f){"use strict";d=[c(39),c(63),c(64)],void 0!==(e=function(a,b,c){function d(b,c){var d=f(g),h=d.find(".qr-container");return new e(h[0],{text:b.url,width:200,height:200}),h.find("table").css("margin","auto"),function(){return a({title:c.label,content:d}).addClass("wechat-qrcode-dialog").open()}}var e=c||window.QRCode,g=f("#tmpl-wechat-share").html();return b.addSnsOption({wechat:{id:"wechat",label:"分享到微信",className:"rec-wechat",onClickify:d}}),b}.apply(b,d))&&(a.exports=e)}).call(b,c(6))},63:function(a,b,c){var d,e;(function(f){"use strict";d=[c(28),c(12)],void 0!==(e=function(a,b){function c(b,c,d){if(d.ga){var e=f.extend({},d.ga);e.dcm=c.id,b=a.addParam(b,e)}return b}function d(a,b,c){return c||(c="…"),a?a.length<=b?a:a.substr(0,b)+c:""}function e(a){return f('meta[property="N"],meta[name="N"]'.replace(/N/g,a)).last().attr("content")}function g(){return{wrapperSel:".share-buttons",wrapper:void 0,title:e("twitter:title")||document.title,desc:e("twitter:description")||e("description"),url:e("twitter:url")||location.href,imageUrl:e("twitter:image")||e("weixin:image"),comment:e("share:comment")||"",ga:{dcs:"not-set"},urlWrapper:c}}function h(a,b){this.options=f.extend({},g(),a),this.snsOptions=f.extend(!0,{},i,b),this.options.desc&&(this.options.desc=d(this.options.desc,160)),this.init()}var i={douban:{id:"douban",label:"豆瓣",popup:{width:660,height:400},className:"rec-douban",urlTmpl:"http://www.douban.com/share/service?bm=1&sel=222&image={{= encodeURIComponent(imageUrl)}}&href={{= encodeURIComponent(url)}}&name={{= encodeURIComponent(title)}}&text={{= encodeURIComponent(desc)}}&comment={{= encodeURIComponent(comment)}}"},doubanDialog:{id:"douban-dialog",label:"豆瓣",className:"rec-douban-dialog"},qqim:{id:"qqim",label:"QQ好友",popup:{width:1e3,height:760},className:"rec-qqim",urlTmpl:'http://connect.qq.com/widget/shareqq/index.html?site={{= encodeURIComponent("豆瓣")}}&url={{= encodeURIComponent(url)}}&desc={{= encodeURIComponent(title)}}&pics={{= encodeURIComponent(imageUrl)}}'},qzone:{id:"qzone",label:"QQ空间",className:"rec-qzone",urlTmpl:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url={{= encodeURIComponent(url)}}&title={{= encodeURIComponent(title)}}&summary={{= encodeURIComponent(desc)}}&pics={{= encodeURIComponent(imageUrl)}}"},weibo:{id:"weibo",label:"新浪微博",className:"rec-weibo",apiKey:"3015934887",popup:{width:650,height:400},urlTmpl:"http://v.t.sina.com.cn/share/share.php?appkey={{= encodeURIComponent(self.apiKey)}}&url={{= encodeURIComponent(url)}}&title={{= encodeURIComponent(comment || title)}}&pic={{= encodeURIComponent(imageUrl)}}&sourceUrl=&content=utf-8"},tencent:{id:"tencent",label:"腾讯微博",className:"rec-tencent",apiKey:"1459b2ac3d2345d2a17396eec5ad3bd7",popup:{width:658,height:352},urlTmpl:"http://v.t.qq.com/share/share.php?appkey={{= encodeURIComponent(self.apiKey)}}&url={{= encodeURIComponent(url)}}&title={{= encodeURIComponent(comment || title)}}&pic={{= encodeURIComponent(imageUrl)}}"},renren:{id:"renren",label:"人人网",className:"rec-renren",popup:{width:1e3,height:760},urlTmpl:"http://widget.renren.com/dialog/share?title={{= encodeURIComponent(title)}}&srcUrl={{= encodeURIComponent(url)}}&resourceUrl={{= encodeURIComponent(url)}}&pic={{= encodeURIComponent(imageUrl)}}&description={{= encodeURIComponent(desc)}}&message={{= encodeURIComponent(comment)}}"}};return f.extend(h.prototype,{snsDefaults:i,init:function(){this.wrapper=this.options.wrapper||f(this.options.wrapperSel);for(var a in this.snsOptions){var b=this.snsOptions[a];if(b){var c=this.wrapper.find("."+b.className);c.length&&(this.renderButton(c,b),this.bindButton(c,b))}}},renderButton:function(a,c){var d=f.extend({self:c},this.options);this.options.urlWrapper&&(d.url=this.options.urlWrapper(d.url,c,this.options)),c.urlTmpl&&(c.url=b(c.urlTmpl,d)),c.onClickify&&(c.onClick=c.onClickify(d,c)),a.data("options",c)},bindButton:function(b,c){var d=this;b.on("click",function(e){return d.options.ga&&ga("send","event",c.id+"-share","click",decodeURIComponent(a.addParam("",d.options.ga))),c.url?d.openWindow(b,c):c.onClick?c.onClick.call(this,e,c):void 0})},openWindow:function(a,b){function c(){window.open(b.url,"sns_share"+ +new Date,j)}var d=navigator.userAgent;if(/(iphone|ipad|android)/i.test(d))return a[0].href=b.url,void(a[0].target="_blank");var e=b.popup||{},f=e.width||440,g=e.height||430,h=(screen.height-g)/2,i=(screen.width-f)/2,j=["toolbar=0","status=0","resizable=1","width="+f,"height="+g,"left="+i,"top="+h].join(",");/firefox/.test(d)?setTimeout(c,0):c()}}),h.addSnsOption=function(a){f.extend(!0,i,a)},h.apply=function(a,b){new h(a,b)},h}.apply(b,d))&&(a.exports=e)}).call(b,c(6))},64:function(a,b){var c;!function(){function a(a){this.mode=j.MODE_8BIT_BYTE,this.data=a,this.parsedData=[];for(var b=0,c=this.data.length;b<c;b++){var d=[],e=this.data.charCodeAt(b);e>65536?(d[0]=240|(1835008&e)>>>18,d[1]=128|(258048&e)>>>12,d[2]=128|(4032&e)>>>6,d[3]=128|63&e):e>2048?(d[0]=224|(61440&e)>>>12,d[1]=128|(4032&e)>>>6,d[2]=128|63&e):e>128?(d[0]=192|(1984&e)>>>6,d[1]=128|63&e):d[0]=e,this.parsedData.push(d)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function b(a,b){this.typeNumber=a,this.errorCorrectLevel=b,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function d(a,b){if(void 0==a.length)throw new Error(a.length+"/"+b);for(var c=0;c<a.length&&0==a[c];)c++;this.num=new Array(a.length-c+b);for(var d=0;d<a.length-c;d++)this.num[d]=a[d+c]}function e(a,b){this.totalCount=a,this.dataCount=b}function f(){this.buffer=[],this.length=0}function g(){var a=!1,b=navigator.userAgent;if(/android/i.test(b)){a=!0;var c=b.toString().match(/android ([0-9]\.[0-9])/i);c&&c[1]&&(a=parseFloat(c[1]))}return a}function h(a,b){for(var c=1,d=i(a),e=0,f=p.length;e<=f;e++){var g=0;switch(b){case k.L:g=p[e][0];break;case k.M:g=p[e][1];break;case k.Q:g=p[e][2];break;case k.H:g=p[e][3]}if(d<=g)break;c++}if(c>p.length)throw new Error("Too long data");return c}function i(a){var b=encodeURI(a).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return b.length+(b.length!=a?3:0)}a.prototype={getLength:function(a){return this.parsedData.length},write:function(a){for(var b=0,c=this.parsedData.length;b<c;b++)a.put(this.parsedData[b],8)}},b.prototype={addData:function(b){var c=new a(b);this.dataList.push(c),this.dataCache=null},isDark:function(a,b){if(a<0||this.moduleCount<=a||b<0||this.moduleCount<=b)throw new Error(a+","+b);return this.modules[a][b]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=new Array(this.moduleCount);for(var e=0;e<this.moduleCount;e++)this.modules[d][e]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(a,c),this.typeNumber>=7&&this.setupTypeNumber(a),null==this.dataCache&&(this.dataCache=b.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,b){for(var c=-1;c<=7;c++)if(!(a+c<=-1||this.moduleCount<=a+c))for(var d=-1;d<=7;d++)b+d<=-1||this.moduleCount<=b+d||(this.modules[a+c][b+d]=0<=c&&c<=6&&(0==d||6==d)||0<=d&&d<=6&&(0==c||6==c)||2<=c&&c<=4&&2<=d&&d<=4)},getBestMaskPattern:function(){for(var a=0,b=0,c=0;c<8;c++){this.makeImpl(!0,c);var d=m.getLostPoint(this);(0==c||a>d)&&(a=d,b=c)}return b},createMovieClip:function(a,b,c){var d=a.createEmptyMovieClip(b,c);this.make();for(var e=0;e<this.modules.length;e++)for(var f=1*e,g=0;g<this.modules[e].length;g++){var h=1*g,i=this.modules[e][g];i&&(d.beginFill(0,100),d.moveTo(h,f),d.lineTo(h+1,f),d.lineTo(h+1,f+1),d.lineTo(h,f+1),d.endFill())}return d},setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=a%2==0);for(var b=8;b<this.moduleCount-8;b++)null==this.modules[6][b]&&(this.modules[6][b]=b%2==0)},setupPositionAdjustPattern:function(){for(var a=m.getPatternPosition(this.typeNumber),b=0;b<a.length;b++)for(var c=0;c<a.length;c++){var d=a[b],e=a[c];if(null==this.modules[d][e])for(var f=-2;f<=2;f++)for(var g=-2;g<=2;g++)this.modules[d+f][e+g]=-2==f||2==f||-2==g||2==g||0==f&&0==g}},setupTypeNumber:function(a){for(var b=m.getBCHTypeNumber(this.typeNumber),c=0;c<18;c++){var d=!a&&1==(b>>c&1);this.modules[Math.floor(c/3)][c%3+this.moduleCount-8-3]=d}for(var c=0;c<18;c++){var d=!a&&1==(b>>c&1);this.modules[c%3+this.moduleCount-8-3][Math.floor(c/3)]=d}},setupTypeInfo:function(a,b){for(var c=this.errorCorrectLevel<<3|b,d=m.getBCHTypeInfo(c),e=0;e<15;e++){var f=!a&&1==(d>>e&1);e<6?this.modules[e][8]=f:e<8?this.modules[e+1][8]=f:this.modules[this.moduleCount-15+e][8]=f}for(var e=0;e<15;e++){var f=!a&&1==(d>>e&1);e<8?this.modules[8][this.moduleCount-e-1]=f:e<9?this.modules[8][15-e-1+1]=f:this.modules[8][15-e-1]=f}this.modules[this.moduleCount-8][8]=!a},mapData:function(a,b){for(var c=-1,d=this.moduleCount-1,e=7,f=0,g=this.moduleCount-1;g>0;g-=2)for(6==g&&g--;;){for(var h=0;h<2;h++)if(null==this.modules[d][g-h]){var i=!1;f<a.length&&(i=1==(a[f]>>>e&1));var j=m.getMask(b,d,g-h);j&&(i=!i),this.modules[d][g-h]=i,-1==--e&&(f++,e=7)}if((d+=c)<0||this.moduleCount<=d){d-=c,c=-c;break}}}},b.PAD0=236,b.PAD1=17,b.createData=function(a,c,d){for(var g=e.getRSBlocks(a,c),h=new f,i=0;i<d.length;i++){var j=d[i];h.put(j.mode,4),h.put(j.getLength(),m.getLengthInBits(j.mode,a)),j.write(h)}for(var k=0,i=0;i<g.length;i++)k+=g[i].dataCount;if(h.getLengthInBits()>8*k)throw new Error("code length overflow. ("+h.getLengthInBits()+">"+8*k+")");for(h.getLengthInBits()+4<=8*k&&h.put(0,4);h.getLengthInBits()%8!=0;)h.putBit(!1);for(;!(h.getLengthInBits()>=8*k)&&(h.put(b.PAD0,8),!(h.getLengthInBits()>=8*k));)h.put(b.PAD1,8);return b.createBytes(h,g)},b.createBytes=function(a,b){for(var c=0,e=0,f=0,g=new Array(b.length),h=new Array(b.length),i=0;i<b.length;i++){var j=b[i].dataCount,k=b[i].totalCount-j;e=Math.max(e,j),f=Math.max(f,k),g[i]=new Array(j);for(var l=0;l<g[i].length;l++)g[i][l]=255&a.buffer[l+c];c+=j;var n=m.getErrorCorrectPolynomial(k),o=new d(g[i],n.getLength()-1),p=o.mod(n);h[i]=new Array(n.getLength()-1);for(var l=0;l<h[i].length;l++){var q=l+p.getLength()-h[i].length;h[i][l]=q>=0?p.get(q):0}}for(var r=0,l=0;l<b.length;l++)r+=b[l].totalCount;for(var s=new Array(r),t=0,l=0;l<e;l++)for(var i=0;i<b.length;i++)l<g[i].length&&(s[t++]=g[i][l]);for(var l=0;l<f;l++)for(var i=0;i<b.length;i++)l<h[i].length&&(s[t++]=h[i][l]);return s};for(var j={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},k={L:1,M:0,Q:3,H:2},l={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},m={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var b=a<<10;m.getBCHDigit(b)-m.getBCHDigit(m.G15)>=0;)b^=m.G15<<m.getBCHDigit(b)-m.getBCHDigit(m.G15);return(a<<10|b)^m.G15_MASK},getBCHTypeNumber:function(a){for(var b=a<<12;m.getBCHDigit(b)-m.getBCHDigit(m.G18)>=0;)b^=m.G18<<m.getBCHDigit(b)-m.getBCHDigit(m.G18);return a<<12|b},getBCHDigit:function(a){for(var b=0;0!=a;)b++,a>>>=1;return b},getPatternPosition:function(a){return m.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,b,c){switch(a){case l.PATTERN000:return(b+c)%2==0;case l.PATTERN001:return b%2==0;case l.PATTERN010:return c%3==0;case l.PATTERN011:return(b+c)%3==0;case l.PATTERN100:return(Math.floor(b/2)+Math.floor(c/3))%2==0;case l.PATTERN101:return b*c%2+b*c%3==0;case l.PATTERN110:return(b*c%2+b*c%3)%2==0;case l.PATTERN111:return(b*c%3+(b+c)%2)%2==0;default:throw new Error("bad maskPattern:"+a)}},getErrorCorrectPolynomial:function(a){for(var b=new d([1],0),c=0;c<a;c++)b=b.multiply(new d([1,n.gexp(c)],0));return b},getLengthInBits:function(a,b){if(1<=b&&b<10)switch(a){case j.MODE_NUMBER:return 10;case j.MODE_ALPHA_NUM:return 9;case j.MODE_8BIT_BYTE:case j.MODE_KANJI:return 8;default:throw new Error("mode:"+a)}else if(b<27)switch(a){case j.MODE_NUMBER:return 12;case j.MODE_ALPHA_NUM:return 11;case j.MODE_8BIT_BYTE:return 16;case j.MODE_KANJI:return 10;default:throw new Error("mode:"+a)}else{if(!(b<41))throw new Error("type:"+b);switch(a){case j.MODE_NUMBER:return 14;case j.MODE_ALPHA_NUM:return 13;case j.MODE_8BIT_BYTE:return 16;case j.MODE_KANJI:return 12;default:throw new Error("mode:"+a)}}},getLostPoint:function(a){for(var b=a.getModuleCount(),c=0,d=0;d<b;d++)for(var e=0;e<b;e++){for(var f=0,g=a.isDark(d,e),h=-1;h<=1;h++)if(!(d+h<0||b<=d+h))for(var i=-1;i<=1;i++)e+i<0||b<=e+i||0==h&&0==i||g==a.isDark(d+h,e+i)&&f++;f>5&&(c+=3+f-5)}for(var d=0;d<b-1;d++)for(var e=0;e<b-1;e++){var j=0;a.isDark(d,e)&&j++,a.isDark(d+1,e)&&j++,a.isDark(d,e+1)&&j++,a.isDark(d+1,e+1)&&j++,0!=j&&4!=j||(c+=3)}for(var d=0;d<b;d++)for(var e=0;e<b-6;e++)a.isDark(d,e)&&!a.isDark(d,e+1)&&a.isDark(d,e+2)&&a.isDark(d,e+3)&&a.isDark(d,e+4)&&!a.isDark(d,e+5)&&a.isDark(d,e+6)&&(c+=40);for(var e=0;e<b;e++)for(var d=0;d<b-6;d++)a.isDark(d,e)&&!a.isDark(d+1,e)&&a.isDark(d+2,e)&&a.isDark(d+3,e)&&a.isDark(d+4,e)&&!a.isDark(d+5,e)&&a.isDark(d+6,e)&&(c+=40);for(var k=0,e=0;e<b;e++)for(var d=0;d<b;d++)a.isDark(d,e)&&k++;return c+=Math.abs(100*k/b/b-50)/5*10}},n={glog:function(a){if(a<1)throw new Error("glog("+a+")");return n.LOG_TABLE[a]},gexp:function(a){for(;a<0;)a+=255;for(;a>=256;)a-=255;return n.EXP_TABLE[a]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},o=0;o<8;o++)n.EXP_TABLE[o]=1<<o;for(var o=8;o<256;o++)n.EXP_TABLE[o]=n.EXP_TABLE[o-4]^n.EXP_TABLE[o-5]^n.EXP_TABLE[o-6]^n.EXP_TABLE[o-8];for(var o=0;o<255;o++)n.LOG_TABLE[n.EXP_TABLE[o]]=o;d.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var b=new Array(this.getLength()+a.getLength()-1),c=0;c<this.getLength();c++)for(var e=0;e<a.getLength();e++)b[c+e]^=n.gexp(n.glog(this.get(c))+n.glog(a.get(e)));return new d(b,0)},mod:function(a){if(this.getLength()-a.getLength()<0)return this;for(var b=n.glog(this.get(0))-n.glog(a.get(0)),c=new Array(this.getLength()),e=0;e<this.getLength();e++)c[e]=this.get(e);for(var e=0;e<a.getLength();e++)c[e]^=n.gexp(n.glog(a.get(e))+b);return new d(c,0).mod(a)}},e.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],e.getRSBlocks=function(a,b){var c=e.getRsBlockTable(a,b);if(void 0==c)throw new Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+b);for(var d=c.length/3,f=[],g=0;g<d;g++)for(var h=c[3*g+0],i=c[3*g+1],j=c[3*g+2],k=0;k<h;k++)f.push(new e(i,j));return f},e.getRsBlockTable=function(a,b){switch(b){case k.L:return e.RS_BLOCK_TABLE[4*(a-1)+0];case k.M:return e.RS_BLOCK_TABLE[4*(a-1)+1];case k.Q:return e.RS_BLOCK_TABLE[4*(a-1)+2];case k.H:return e.RS_BLOCK_TABLE[4*(a-1)+3];default:return}},f.prototype={get:function(a){var b=Math.floor(a/8);return 1==(this.buffer[b]>>>7-a%8&1)},put:function(a,b){for(var c=0;c<b;c++)this.putBit(1==(a>>>b-c-1&1))},getLengthInBits:function(){return this.length},putBit:function(a){var b=Math.floor(this.length/8);this.buffer.length<=b&&this.buffer.push(0),a&&(this.buffer[b]|=128>>>this.length%8),this.length++}};var p=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],q=function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){function b(a,b){var c=document.createElementNS("http://www.w3.org/2000/svg",a);for(var d in b)b.hasOwnProperty(d)&&c.setAttribute(d,b[d]);return c}var c=this._htOption,d=this._el,e=a.getModuleCount();Math.floor(c.width/e),Math.floor(c.height/e),this.clear();var f=b("svg",{viewBox:"0 0 "+String(e)+" "+String(e),width:"100%",height:"100%",fill:c.colorLight});f.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),d.appendChild(f),f.appendChild(b("rect",{fill:c.colorLight,width:"100%",height:"100%"})),f.appendChild(b("rect",{fill:c.colorDark,width:"1",height:"1",id:"template"}));for(var g=0;g<e;g++)for(var h=0;h<e;h++)if(a.isDark(g,h)){var i=b("use",{x:String(h),y:String(g)});i.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),f.appendChild(i)}},a.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},a}(),r="svg"===document.documentElement.tagName.toLowerCase(),s=r?q:function(){return"undefined"!=typeof CanvasRenderingContext2D}()?function(){function a(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function b(a,b){var c=this;if(c._fFail=b,c._fSuccess=a,null===c._bSupportDataURI){var d=document.createElement("img"),e=function(){c._bSupportDataURI=!1,c._fFail&&c._fFail.call(c)},f=function(){c._bSupportDataURI=!0,c._fSuccess&&c._fSuccess.call(c)};return d.onabort=e,d.onerror=e,d.onload=f,void(d.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}!0===c._bSupportDataURI&&c._fSuccess?c._fSuccess.call(c):!1===c._bSupportDataURI&&c._fFail&&c._fFail.call(c)}if(this._android&&this._android<=2.1){var c=1/window.devicePixelRatio,d=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(a,b,e,f,g,h,i,j,k){if("nodeName"in a&&/img/i.test(a.nodeName))for(var l=arguments.length-1;l>=1;l--)arguments[l]=arguments[l]*c;else void 0===j&&(arguments[1]*=c,arguments[2]*=c,arguments[3]*=c,arguments[4]*=c);d.apply(this,arguments)}}var e=function(a,b){this._bIsPainted=!1,this._android=g(),this._htOption=b,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=b.width,this._elCanvas.height=b.height,a.appendChild(this._elCanvas),this._el=a,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return e.prototype.draw=function(a){var b=this._elImage,c=this._oContext,d=this._htOption,e=a.getModuleCount(),f=d.width/e,g=d.height/e,h=Math.round(f),i=Math.round(g);b.style.display="none",this.clear();for(var j=0;j<e;j++)for(var k=0;k<e;k++){var l=a.isDark(j,k),m=k*f,n=j*g;c.strokeStyle=l?d.colorDark:d.colorLight,c.lineWidth=1,c.fillStyle=l?d.colorDark:d.colorLight,c.fillRect(m,n,f,g),c.strokeRect(Math.floor(m)+.5,Math.floor(n)+.5,h,i),c.strokeRect(Math.ceil(m)-.5,Math.ceil(n)-.5,h,i)}this._bIsPainted=!0},e.prototype.makeImage=function(){this._bIsPainted&&b.call(this,a)},e.prototype.isPainted=function(){return this._bIsPainted},e.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},e.prototype.round=function(a){return a?Math.floor(1e3*a)/1e3:a},e}():function(){var a=function(a,b){this._el=a,this._htOption=b};return a.prototype.draw=function(a){for(var b=this._htOption,c=this._el,d=a.getModuleCount(),e=Math.floor(b.width/d),f=Math.floor(b.height/d),g=['<table style="border:0;border-collapse:collapse;">'],h=0;h<d;h++){g.push("<tr>");for(var i=0;i<d;i++)g.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+e+"px;height:"+f+"px;background-color:"+(a.isDark(h,i)?b.colorDark:b.colorLight)+';"></td>');g.push("</tr>")}g.push("</table>"),c.innerHTML=g.join("");var j=c.childNodes[0],k=(b.width-j.offsetWidth)/2,l=(b.height-j.offsetHeight)/2;k>0&&l>0&&(j.style.margin=l+"px "+k+"px")},a.prototype.clear=function(){this._el.innerHTML=""},a}();c=function(a,b){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:k.H},"string"==typeof b&&(b={text:b}),b)for(var c in b)this._htOption[c]=b[c];"string"==typeof a&&(a=document.getElementById(a)),this._htOption.useSVG&&(s=q),this._android=g(),this._el=a,this._oQRCode=null,this._oDrawing=new s(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},c.prototype.makeCode=function(a){this._oQRCode=new b(h(a,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(a),this._oQRCode.make(),this._el.title=a,this._oDrawing.draw(this._oQRCode),this.makeImage()},c.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},c.prototype.clear=function(){this._oDrawing.clear()},c.CorrectLevel=k}(),a.exports=c},65:function(a,b,c){var d,e;d=[c(2),c(3),c(9)],void 0!==(e=function(a,b,c){return a.Model.extend({defaults:{articleId:0,liked:!1,n_like:null},url:function(){return"/j/article/"+this.get("articleId")+"/like"},toggleFavor:function(){var a=this;if(!this.waiting){var d=!this.get("liked"),e=d?"post":"delete";return this.set("liked",d),this.set({liked:d,n_like:this.get("n_like")+(d?1:-1)}),this.waiting=!0,c({url:b.result(this,"url"),type:e}).then(null,function(){a.set({liked:!d,n_like:a.get("n_like")+(d?-1:1)})}).always(function(){a.waiting=!1}),this}}})}.apply(b,d))&&(a.exports=e)},66:function(a,b,c){var d,e;d=[c(2),c(3),c(6),c(20)],void 0!==(e=function(a,b,c,d){return a.View.extend({className:"purchase-guide",template:c("#tmpl-purchase-guide").html(),render:function(a){var c=b.pick(a.model.toJSON(),"id","price");return c.device=d.ua.device,this.$el.html(b.template(this.template,c)),this}})}.apply(b,d))&&(a.exports=e)},67:function(a,b,c){var d,e;d=[c(2),c(3),c(6),c(21),c(50),c(68),c(69),c(72),c(73)],void 0!==(e=function(a,b,c,d,e,f,g,h,i){var j=c("#tmpl-rating-comment").html(),k=c("#tmpl-form-buttons").html(),l=a.View.extend({initialize:function(){b.bindAll(this,"cancelEditing","renderError"),this.app=d},template:c("#tmpl-rating-form").html(),render:function(){this.stopListening(this.model);var a=this;return this.model.get("synced")&&(this.model.get("failed")?this.renderError():this.renderForm()),this.listenTo(this.model,"sync change:editingMode change:unfinishedRating",function(){a.renderForm(),a.trigger("updated")}),this},renderForm:function(){var a=this.model;this.$el.html(this.template),this.renderRating(a),this.renderComment(a),this.renderFormButtons(a),this.renderSharingOptions(a),this.bindFormActions(a),e.ctrlEnterForm(this.$el)},renderError:function(){this.$el.html(this.template),this.$(".rating-form").html(c("<div>",{class:"field-group"}).text("您目前无法评价本文"))},renderRating:function(a){var b=this,c=new g({model:a});a.get("rated")&&!a.get("editingMode")?c.undelegateEvents():c.on("stars:changed",function(c){a.set("unfinishedRating",c),b.trigger("rating:changed")}),this.$el.find(".rating").html(c.render().el)},renderComment:function(a){this.$el.find("#field-edit").html(b.template(j,a.toJSON())),this.$el.find("textarea").on("keyup",function(b){a.set("unfinishedComment",b.currentTarget.value)})},renderFormButtons:function(a){this.$(".form-btns").html(b.template(k,a.toJSON()))},renderSharingOptions:function(a){var b=this.$(".sharing-options-wrapper");if(a.get("rated"))return void b.html("");var c=new i;this.initializeSharing(c),b.html(this.renderSharingHtml({sharingLabel:"同步"})),this.bindSharingActions(),a.once("sync",function(){c.saveConfigToStroage()})},cancelEditing:function(){this.model.set({editingMode:!1,unfinishedComment:"",unfinishedRating:0}),this.trigger("cancel")},bindFormActions:function(a){var b=this,c=this.$el.find("form"),d=c.find(".validation-error"),f=c.find(".btn-cancel"),g=c.find(".link-edit");c.off("submit"),a.on("invalid",function(a,b){d.text(b)}),f.on("click",function(c){c.preventDefault(),b.cancelEditing(a)}),g.on("click",function(a){a.preventDefault(),b.trigger("linkEdit:clicked"),b.model.set("editingMode",!0),b.renderForm(),b.trigger("updated")}),c.on("submit",function(b){b.preventDefault(),b.stopPropagation();var d=c.find("[data-stars]")[0].getAttribute("data-stars"),f=e.toDict(c);f.rating=d,f.rated=+d,f.unfinishedComment="",f.unfinishedRating=0,f.editingMode=!1,a.set(f),a.save()})}});return b.extend(l.prototype,h),l}.apply(b,d))&&(a.exports=e)},68:function(a,b,c){var d,e;(function(f){"use strict";d=[c(2),c(3)],void 0!==(e=function(a,b){return a.Model.extend({defaults:{rating:0,articleId:0,rated:!1,comment:"",share_dou:"",share_weibo:"",share_site:"",synced:!1,failed:!1,unfinishedComment:"",unfinishedRating:0,editingMode:!1},url:function(){return"/j/article_v2/"+this.get("articleId")+"/rating"},validate:function(a){var b=0|a.rating;if(f.trim(a.comment),!b)return"请先为作品打分"}})}.apply(b,d))&&(a.exports=e)}).call(b,c(6))},69:function(a,b,c){var d,e;d=[c(2),c(6),c(70),c(71)],void 0!==(e=function(a,b,c,d){var e=a.View.extend({template:b("#tmpl-rating").html(),events:{"mouseover .star-region":"hoveringStar","mouseout .stars-context":"resumeStar","click .star-region":"rate"},render:function(){return this.$el.html(d(this.template,this.model.toJSON())),this.starsContext=this.$el.find(".stars-context").get(0),this.stars=this.starsContext.getAttribute("data-stars"),this}});return b.extend(e.prototype,c),e}.apply(b,d))&&(a.exports=e)},70:function(a,b,c){var d,e;d=[],void 0!==(e=function(){return{rate:function(a){a.preventDefault(),this.stars=this.parseStar(a.target),this.starsContext.setAttribute("data-stars",this.stars),this.trigger("stars:changed",this.stars)},parseStar:function(a){return a.getAttribute("data-star")},hoveringStar:function(a){var b=this.parseStar(a.target);this.displayStar(b)},resumeStar:function(){this.displayStar(this.stars)},displayStar:function(a){var b=this.starsContext.className;this.starsContext.className=b.replace(/stars-\d+/g,"stars-"+a)}}}.apply(b,d))&&(a.exports=e)},71:function(a,b,c){var d,e;d=[c(3)],void 0!==(e=function(a){function b(b,c){this.data=b,a.extend(this,c)}return function(c,d,e){return d=a.isArray(d)?d:[d],a.map(d,function(d){return d.$item=new b(d,e||{}),a.template(c,d)}).join("")}}.apply(b,d))&&(a.exports=e)},72:function(a,b,c){var d,e;d=[c(6),c(3),c(2),c(21),c(9),c(25),c(31)],void 0!==(e=function(a,b,c,d,e,f,g){return{tmplSharingActions:a("#tmpl-sharing-actions").html(),tmplShareWeibo:a("#tmpl-share-weibo").html(),disabledLabel:"请选择分享到哪里",initializeSharing:function(a,c){c=b.extend({disableWithoutSharing:!0},c),b.bindAll(this,"disableFormWithoutChecked","renderWeiboAction","updateVisible","updateModel"),this.formModel=a,a.fetchIsWeiboBinded({success:this.renderWeiboAction}),c.disableWithoutSharing&&(a.listenAttrsChange("sharing",this.disableFormWithoutChecked),this.disableFormWithoutChecked(a))},bindSharingActions:function(){this.settingBtn=this.$(".share-setting"),this.visibleChecker=this.$(".note-visible-wrapper input"),this.shareText=this.$(".textarea-text"),this.$("input[type=checkbox]").on("change",this.updateModel),this.visibleChecker.on("change",this.updateVisible),this.updateVisible()},defaultRenderOptions:{hasLabel:!0,hasVisibleSetting:!1,allowShare:!0},renderSharingHtml:function(a){return b.template(this.tmplSharingActions,b.extend(b.defaults(a,this.defaultRenderOptions),this.formModel.pickAttrs("sharing")))},renderWeiboAction:function(a){var c=this.$el.find(".item-weibo-wrapper"),d=this.$el.find(".weibo-setting");c.html(b.template(this.tmplShareWeibo,{weiboBinded:a,share_weibo:this.formModel.get("share_weibo")})),a?(this.formModel.weiboBinded=!0,this.$("#share-weibo").on("change",this.updateModel)):this.formModel.set("share_weibo",""),c.toggle(a),d.toggle(!a),this.settingBtn.toggle(a),this.updateVisible(),this.trigger("updated")},updateSharingText:function(){var b=this,c=d.getModel("article"),f=(this.$el.find(".item-weibo"),c?c.get("id"):location.pathname.split("/")[3]),g="";c&&(g=c.get("defaultSharingText"),this.shareText.val(g?g+" ":"")),f&&!d.getModel("config").get("isChapter")&&e.get("/ebook/"+f+"/events",function(c){if(c.hashtag){var d=a.trim(b.shareText.text()),e=(d.length?" ":"")+"#"+c.hashtag+"# ";b.shareText.val(d+e)}})},isPrivate:function(){return this.visibleChecker.is(":checked")},updateVisible:function(){var a=this.$(".share-options"),b=a.find("label, .label"),c=a.find("input[type=checkbox]"),d=this.isPrivate();b.toggleClass("disabled",d),c.prop("disabled",d),this.updateShareOptions(d)},updateShareOptions:function(a){var c,d=this.formModel.pickAttrs("sharing"),e=this.$(".share-options input[type=checkbox]");b.each(d,function(b,d){b=!a&&b,(c=e.filter("[name="+d+"]")[0])&&(c.checked=b)},this)},disableFormWithoutChecked:function(a){var b=!a.hasSharing(),c=this.$(".btn-post");b!==c.prop("disabled")&&c.prop("disabled",b).toggleClass("btn-disabled",b).text(b?this.disabledLabel:"确定")},updateModel:function(b){var c=a(b.currentTarget),d=c.attr("name"),e=c.prop("checked");this.formModel.set(d,e?"on":"")},getText:function(){return this.parseText(this.$("textarea[name=text]").val())},parseText:function(b){return a.trim(b).replace(/\n/g," ")}}}.apply(b,d))&&(a.exports=e)},73:function(a,b,c){var d,e;d=[c(2),c(3),c(6),c(20),c(9),c(33)],void 0!==(e=function(a,b,c,d,e,f){var g=["broadcast_to_site","share_dou","share_weibo"];return a.Model.extend({defaults:function(){return b.extend({share_dou:"on",share_weibo:"on",broadcast_to_site:"",text:""},this.getConfigFromStorage()||{})},initialize:function(a,b){b&&b.url&&(this.url=b.url)},attrsGroup:{config:g,checkbox:g,sharing:g},getGroupKeys:function(a){var b=this.attrsGroup[a];if(!b)throw"`attrsGroup[groupName:"+a+"]` is not found";return b},pickAttrs:function(a){var b=this.getGroupKeys(a);return this.pick(b)},listenAttrsChange:function(a,c,d){var e=this.getGroupKeys(a),f=b.map(e,function(a){return"change:"+a}).join(" ");this.on(f,c,d)},configStroageKey:"sharingFormDefaults",getConfigFromStorage:function(){var a=f.get(this.configStroageKey);if(a)return JSON.parse(a)},saveConfigToStroage:function(a){a=a||"config";var c,d=this.pickAttrs(a);c=this.getConfigFromStorage(),d=b.defaults(d,c),f.set(this.configStroageKey,JSON.stringify(d))},fetchIsWeiboBinded:function(a){a=a||{};var b=this,c=this.get("share_weibo");this.set("share_weibo",""),e.get("/j/share/check_sina",function(d){var e=d.bind;b.set("share_weibo",c),e||b.unset("share_weibo"),a.success&&a.success(e)})},hasSharing:function(){var a=this.pickAttrs("sharing");return b.chain(a).values().some().value()}})}.apply(b,d))&&(a.exports=e)},74:function(a,b,c){var d,e;(function(f){"use strict";d=[c(9),c(12),c(60),c(39)],void 0!==(e=function(a,b,c,d){return{$el:f("<div>",{class:"donate-bar"}),tmpl:f("#tmpl-donate-show").html(),tmplAll:f("#tmpl-donate-all").html(),tmplDialog:f("#tmpl-donate-dialog").html(),tmplDialogFinished:f("#tmpl-donate-finished").html(),init_url:"/j/donate/init",create_url:"/j/donate/create",deposit_url:"/j/donate/",check_url:"/j/donate/check_pay",feedback_url:"//help.douban.com/help/ask?category=book&type=43",data:{isFetched:!1,inMobile:!1,works_id:0,donation_id:0,donators:[],donators_count:0,author_name:"",title:"",type:"",deposit:"",latest_deposite:"alipay",pay_url:"/account/donate",mobile_donate_uri:"/account/donate?works_id={{- works_id }}&source={{- page_type}}",mobile_donor_uri:"/ebook/{{- works_id }}/donators",page_type:""},initialize:function(a){return this.data=f.extend(this.data,a),a.inMobile?(this.data.mobile_donate_uri=b(this.data.mobile_donate_uri,this.data),this.data.mobile_donor_uri=b(this.data.mobile_donor_uri,this.data)):(this.$el.on("click",".donate-btn",this.openDialog.bind(this)),this.$el.on("click",".donate-list .all",this.showAll.bind(this))),this.updateDonationList(),this},showAll:function(){var a=b(this.tmplAll,{donators:this.data.donators});d({title:"送花读者（"+this.data.donators_count+"）",content:a}).addClass("donate-all").open()},checkLogin:function(){var a={closable:!0,referUrl:location.href},b=window.Ark.me&&window.Ark.me.isAnonymous;return b&&(document.cookie="refer_url="+location.href+";domain=douban.com;path=/",new c(a)),!b},openDialog:function(){if(this.data.author_name&&this.checkLogin()){var a=b(this.tmplDialog,this.data),c=d({type:"confirm",title:"给《%》送花".replace("%",this.data.title),content:a}).open();c.on("confirm",this.preDonate.bind(this)),this.mainDialog=c,this.mainDialogEl=c.el,this.dialogInit(this.mainDialogEl),this.isDonating=!1}},dialogInit:function(a){var b=this;this.amountLiEls=a.find(".donate-price li"),this.bankLiEls=a.find(".donate-type li"),this.customAmtEl=a.find("[name=custom_amount]"),this.depositEl=a.find("[value=deposit]"),this.preferEl=a.find("input[name=bankcode][value="+this.data.latest_deposite+"]"),this.postForm=a.find(".donate-post"),this.userForm=a.find(".donate-dialog"),this.displayAmountEle=a.find(".display-amount"),this.amountLen=this.amountLiEls.length,a.find(".text-cover").on("click",this.customAmtFocus.bind(this)),this.customAmtEl.on("click",this.customAmtFocus.bind(this)).on("blur",this.customAmtBlur.bind(this)).on("input propertychange",this.getBalance.bind(this)),this.amountLiEls.on("change","input[type=radio]",function(){var a=f(this).data("id");b.amountChange(a)}),this.bankLiEls.on("change","input[type=radio]",function(){var a=f(this).data("id");b.bankLiEls.eq(a).addClass("active").siblings("li").removeClass("active")}),this.userForm.on("submit",function(a){return a.preventDefault(),!1}),this.preferEl.prop("checked",!0),this.preferEl.closest("li").addClass("active"),this.getBalance(),this.customAmtEl.attr("oninput","value = parseInt(Math.min(Math.max(value, 0), 999), 10)")},customAmtFocus:function(){this.amountLiEls.eq(-1).find("input[name=amount]").prop("checked",!0),this.amountChange(this.amountLen-1),this.getBalance(),this.customAmtEl.closest("li").addClass("focus")},customAmtBlur:function(){this.validateAmount(),this.customAmtEl.closest("li").removeClass("focus")},amountChange:function(a){var b=this;this.amountLiEls.eq(a).addClass("active").siblings("li").removeClass("active"),a===this.amountLen-1?setTimeout(function(){b.customAmtEl.focus()},10):this.validateAmount()},validateAmount:function(){var a=parseInt(this.customAmtEl.val(),10);isNaN(a)||a<1?(this.customAmtEl.val(""),this.customAmtEl.closest("li").removeClass("active valid")):(a=Math.min(a,999),this.customAmtEl.val(a),this.customAmtEl.closest("li").addClass("valid")),this.getBalance()},getCurrentState:function(){var a=0,b=this.mainDialogEl.find("[name=amount]:checked").val(),c=this.customAmtEl.val(),d=!1;return a="custom"!==b?parseInt(b,10):parseInt(c,10),d=!a&&this.data.deposit>0||a<=this.data.deposit,[d,a]},getBalance:function(){var a=this.getCurrentState()[0],b=this.getCurrentState()[1],c=this.depositEl.prop("checked"),d=isNaN(b)?"":"￥ "+Math.min(Math.max(b,0),999).toFixed(2);!a&&c?this.preferEl.prop("checked",!0).closest("li").addClass("active").siblings("li").removeClass("active"):a&&this.depositEl.prop("checked",!0).closest("li").addClass("active").siblings("li").removeClass("active"),this.depositEl.prop("disabled",!a).closest("label").toggleClass("not-allowed",!a),this.displayAmountEle.text(d)},preDonate:function(){var b=this,c=Math.round(100*this.getCurrentState()[1]);if(isNaN(c))return void alert("请选择送花数量或自定义");this.isDonating||(this.isDonating=!0,a({url:this.create_url,type:"POST",data:{works_id:this.data.works_id,amount:c},dataType:"json",async:!1,success:function(a){a.r?(b.openFinishedDialog(!1),this.isDonating=!1):(b.data.donation_id=a.donation_id,b.postDonate())},fail:function(){b.openFinishedDialog(!1),this.isDonating=!1}}))},postDonate:function(){var b=this,c=this.postForm,d=this.getCurrentState()[0],e=this.data.donation_id,f=this.mainDialogEl.find("[name=bankcode]:checked").val(),g=this.mainDialogEl.find("[name=tweet_to_broadcast]").prop("checked")?1:0;if(e)if(d&&"deposit"===f){var h={donation_id:e,tweet_to_broadcast:g};a.post(this.deposit_url,h).done(function(a){a.r?(alert(a.err),b.openFinishedDialog(!1)):b.openFinishedDialog(!0)}).fail(function(){b.openFinishedDialog(!1)}).always(function(){b.isDonating=!1})}else c.find("[name=donation_id]").val(e),c.find("[name=bankcode]").val(f),c.find("[name=tweet_to_broadcast]").val(g),c.trigger("submit"),this.openWaitingDialog(),this.isDonating=!1},openFinishedDialog:function(a){this.mainDialog.close(),this.updateDonationList(),this.dialogWait&&this.dialogWait.close();var c=b(this.tmplDialogFinished,{isSuccess:a}),e=d({title:"给《%》送花".replace("%",this.data.title),content:c}).addClass("donate-after").open(),f=e.el.find(".help-block span");setTimeout(function(){f.html("2")},1e3),setTimeout(function(){f.html("1")},2e3),setTimeout(function(){e.close()},3e3)},openWaitingDialog:function(){var a=this;this.mainDialog.close(),this.dialogWait=d({type:"confirm",title:"等待支付",content:"请在新打开的页面中完成支付"}).addClass("donate-after").setButtons([{text:"已完成支付"},{text:"遇到问题"}]).open().on("confirm",this.checkPay.bind(this)).on("cancel",function(){window.open(a.feedback_url)}),f(document).one("deposite-success",this.checkPay.bind(this))},checkPay:function(){var b=this;a.post(this.check_url,{donation_id:this.data.donation_id}).done(function(a){a.r?alert(a.err):b.openFinishedDialog(!0)}).fail(function(){alert("支付尚未完成")})},updateDonationList:function(){var b=this;a.post(this.init_url,{works_id:b.data.works_id}).done(function(a){if(!a.r){if(!a.is_on_sale)return void b.$el.hide();b.data.isFetched=!0,b.data.donators=a.donators,b.data.donators_count=a.donators_count,b.data.author_name=a.author_name,b.data.deposit=a.balance_from_deposit/100||0,b.data.title=a.works_title,b.data.type=a.type_name_cn,b.render()}})},render:function(){return this.$el.html(b(this.tmpl,this.data)),this}}}.apply(b,d))&&(a.exports=e)}).call(b,c(6))},76:function(a,b,c){var d,e;d=[c(6),c(2),c(3),c(20),c(21),c(77),c(78),c(36),c(9),c(80)],void 0!==(e=function(a,b,c,d,e,f,g,h,i,j){function k(a){l[a.get("id")]=a}var l={};return b.View.extend({initialize:function(b){this.modelDfd=a.Deferred(),this.modelPromise=this.modelDfd.promise(),this.initChapters(b.columnId,b.chapterId)},render:function(a){return this.canvas=a.canvas,this.resetAdapter(),this.adaptCanvas(),this},initChapters:function(a,b){this.chaptersCollection=new g([],{columnId:a,currChapterId:b}),e.setModel("chapters",this.chaptersCollection),this.columnModel=new f({id:a}),e.setModel("column",this.columnModel),this.columnModel.on("change:chapters",function(a,b){this.chaptersCollection.reset(b),this._markCurrChapterAsRead(),this.modelDfd.resolve()},this),a in l?this.columnModel.set(l[a].toJSON()):this.columnModel.fetch(),k(this.columnModel),e.vent.on("turningPrev:firstPage",this.turnPrevChapter,this).on("turningNext:lastPage",this.turnNextChapter,this).on("chapterTurn:adjacent",this.adjacentTurnPrompt,this).on("reader:layout:finish",this.checkToShowGift,this).on("show:giftOverlay",this.showGift,this);var c=this.chaptersCollection.currChapter;this.listenTo(c,"change:chapterId",function(b,c){var d=["column",a,"chapter",c,""].join("/");e.router.navigate(d,{trigger:!0})}),this.pipeEvents(c,["change:isFirstChapter","change:isLastChapter"])},pipeEvents:function(a,b){var d=this;return c.each(b,function(b){d.listenTo(a,b,c.bind(d.trigger,d,b))}),this},_markCurrChapterAsRead:function(){var a=this.chaptersCollection,b=a.getCurrChapter();b&&b.set("is_read",!0),this.columnModel.set("chapters",a.models)},cleanChapters:function(){this.chaptersCollection.destroy(),e.unsetModel("chapters"),e.unsetModel("column")},adaptCanvas:function(){this.initChapterOverlay(),this.bindChapterPosClass(this.canvas.$el)},resetAdapter:function(){this.canvas.$el.find(".chapter-overlay").off(".chapter-adapter")},initChapterOverlay:function(){this.canvas.$el.find(".chapter-overlay").on("click.chapter-adapter",".chapter-switcher",c.bind(function(b){this["prev"===a(b.currentTarget).data("direction")?"turnPrevChapter":"turnNextChapter"]()},this))},bindChapterPosClass:function(a){this.on("change:isFirstChapter",function(b,c){a.toggleClass("first-chapter",c)}).on("change:isLastChapter",function(b,c){a.toggleClass("last-chapter",c)});var b=this.chaptersCollection.currChapter;a.toggleClass("first-chapter",b.get("isFirstChapter")).toggleClass("last-chapter",b.get("isLastChapter"))},turnPrevChapter:function(){if(this.chaptersCollection.currChapter.get("isFirstChapter"))return void h.toast("没有上一篇了");e.getModel("config").set("jumpLastPage",!0),this.chaptersCollection.turnPrevChapter()},turnNextChapter:function(){if(this.chaptersCollection.currChapter.get("isLastChapter"))return void h.toast("没有下一篇了");e.getModel("config").set("jumpFirstPage",!0),this.chaptersCollection.turnNextChapter()},checkToShowGift:function(){var a=this.columnModel.get("gift");a&&!a.opened&&(a.opened=!0,this.showGift())},showGift:function(){var a=this.columnModel.get("gift");a&&(this.giftOverlay=new j({gift:a}),this.giftOverlay.open())},remove:function(){this.resetAdapter(),this.cleanChapters(),e.vent.off("turningPrev:firstPage"),e.vent.off("turningNext:lastPage"),e.vent.off("chapterTurn:adjacent"),b.View.prototype.remove.apply(this,arguments)},labelsMap:{prev:"上一篇",next:"下一篇"},jumpingTmpl:"<span>{{- label}}</span><div>{{= title}}</div>",adjacentTurnPrompt:function(a){if(e.hasModel("article")){var b=e.getModel("article"),d={title:b.get("title"),label:this.labelsMap[a.direction]};h.toast(c.template(this.jumpingTmpl,d))}}})}.apply(b,d))&&(a.exports=e)},77:function(a,b,c){var d,e;d=[c(2),c(3),c(9)],void 0!==(e=function(a,b,c){return a.Model.extend({defaults:{id:0,is_subscribed:!1},url:function(){return"/j/column/"+this.get("id")+"/"},subscribeUrl:function(){return"/j/column/"+this.get("id")+"/subscription"},urlInMobileStore:function(){return"/column/"+this.get("id")},subscribe:function(){return this.toggleSubscribe(!0)},toggleSubscribe:function(a){return b.isUndefined(a)&&(a=!this.get("is_subscribed")),c({method:a?"put":"delete",url:b.result(this,"subscribeUrl")}).done(b.bind(function(b){this.set("is_subscribed",a)},this))}})}.apply(b,d))&&(a.exports=e)},78:function(a,b,c){var d,e;d=[c(2),c(3),c(79)],void 0!==(e=function(a,b,c){var d=a.Model.extend({defaults:{chapterId:0,isFirstChapter:!1,isLastChapter:!1},setPositionFlag:function(a,b){return this.set("isFirstChapter",a<=0),this.set("isLastChapter",a===b-1),this}});return a.Collection.extend({model:c,initialize:function(a,c){b.bindAll(this,"turnPrevChapter","turnNextChapter"),this.columnId=c.columnId,this.currChapter=new d({chapterId:c.currChapterId}),this.on("reset",function(){var a=this.getCurrIndex();this.currChapter.setPositionFlag(a,this.length)})},getCurrChapter:function(){return this.get(this.currChapter.get("chapterId"))},getCurrIndex:function(){return this.indexOf(this.getCurrChapter())},turnNextChapter:function(){var a=this.getCurrIndex();return this.turnByIndex(a+1)},turnPrevChapter:function(){var a=this.getCurrIndex();return this.turnByIndex(a-1)},turnByIndex:function(a){return a>=0&&a<this.length&&(this.turnById(this.at(a).id),this.currChapter.setPositionFlag(a,this.length)),this},turnById:function(a){return this.get(a)&&this.currChapter.set("chapterId",a),this},destroy:function(){this.currChapter.off(),this.off()},currChapterNeedBuy:function(){var a=this.getCurrChapter();return a&&a.needBuy()}})}.apply(b,d))&&(a.exports=e)},79:function(a,b,c){var d,e;d=[c(2),c(3)],void 0!==(e=function(a,b){return a.Model.extend({needBuy:function(){return!this.get("is_free")&&!this.get("is_allowed_to_read")}})}.apply(b,d))&&(a.exports=e)},80:function(a,b,c){var d,e;d=[c(3),c(6),c(20),c(40)],void 0!==(e=function(a,b,c,d){function e(a){this.gift=a.gift}var f=b("#tmpl-gift-inner").html();return a.extend(e.prototype,{open:function(){var b=this.gift,e=d({closeable:!0,klass:"full-height-overlay gift-overlay-wrapper",body:a.template(f,{page:{note:{recipient:c.me.name,words:b.words,sender:b.sender,date:b.date}}})});e.body.on("click",".close",function(){e.close()}),e.open(),this.overlay=e},close:function(){this.overlay&&(this.overlay.close(),delete this.overlay)}}),e}.apply(b,d))&&(a.exports=e)},199:function(a,b,c){var d,e;d=[c(6),c(3),c(20),c(33)],void 0!==(e=function(a,b,c,d){var e=/^e\d+/;return{freeUpStorageSpace:function(){for(var a=this.getArticleKeys(),b=a.length;b>=5;)b-=1,d.remove(a.pop())},checkStorageVersion:function(){return this.hasStorageData()?this.getReaderDataVersion()===c.READER_DATA_VERSION||(this.resetReaderData(),!1):(this.saveReaderDataVersion(),!0)},resetReaderData:function(){this.emptyArticles(),this.saveReaderDataVersion()},saveReaderDataVersion:function(){d.set("readerDataVersion",c.READER_DATA_VERSION)},hasStorageData:function(){var a=d.get("hasStorageData");return a=!!a||!!d.get("layout"),d.set("hasStorageData",!0),a},getReaderDataVersion:function(){return d.get("readerDataVersion")||"v1.1.0"},getArticle:function(a){var b=d.get("e"+a);if(b)return b=b.split(":"),{title:b[0],data:b[1],purchase_time:0|b[2],is_sample:!!(0|b[3]),is_gift:!!(0|b[4]),has_formula:!!(0|b[5]),has_added:!!(0|b[6]),price:+b[7],lang:b[8],cover_url:decodeURIComponent(b[9]),fixed_price:+b[10]}},saveArticle:function(a,b){var c=encodeURIComponent(b.cover_url.split("?")[0]),e=[0|b.purchase_time,0|b.is_sample,0|b.is_gift,0|b.has_formula,0|b.has_added,+b.price,b.lang,c,+b.fixed_price].join(":");d.set("e"+a,[b.title,b.data,e].join(":"))},emptyArticles:function(){var a=this.getArticleKeys();b.each(a,function(a){d.remove(a)})},getArticleKeys:function(){var a=d.keys();return b.filter(a,function(a){return e.test(a)})},setArticleAttr:function(a,b,c){var d=this.getArticle(a);d&&(d[b]=c,this.saveArticle(a,d))},resetForDifferentUser:function(a){a=a||"anonymous",d.get("readerUserId")!==a&&this.resetReaderData(),d.set("readerUserId",a)}}}.apply(b,d))&&(a.exports=e)},325:function(a,b,c){var d,e;(function(f){"use strict";d=[c(2),c(9)],void 0!==(e=function(a,b){return a.Model.extend({defaults:{name:"匿名用户"},url:function(){return"/j/user/"+this.get("id")+"/"},initialize:function(){this.on("sync",function(){this._loaded=!0},this),this.on("request",function(a,b,c){if(!a.get("id"))return f.Deferred().reject()})},isLoaded:function(){return!!this._loaded&&this.has("avatar")},isAdmin:function(){return!!this.get("isAdmin")},isAnonymous:function(){return!!this.get("isAnonymous")},isAuthorOf:function(a){var b=a.get("authorId"),c=this.get("id");return b&&b.toString()===c.toString()},canRate:function(a){return!(this.isAnonymous()||a.get("isSample"))}})}.apply(b,d))&&(a.exports=e)}).call(b,c(6))}});